# SnapQuote 제품 요구사항 문서 (PRD)
**버전:** 4.1 (통합본)
**날짜:** 2026-01-16
**상태:** 개발 진행 중

---

## 1. 개요 (Executive Summary)
**SnapQuote**는 현장 기술자(배관공, 전기기사, 도급업자)를 위해 설계된 오프라인 우선, AI 기반 견적 산출 도구입니다. 인터넷 연결이 없는 환경에서도 음성 입력을 사용하여 30초 만에 전문적인 영문 견적서를 생성할 수 있습니다.

**핵심 가치 제안:**
> "일거리를 집으로 가져가지 마세요."
> 입력: 30초 음성 (더러운 장갑 낀 손) → 처리: 오프라인/AI → 출력: 전문 PDF (깔끔한 견적서)

---

## 2. 제품 현황 개요

### 2.1 현재 개발 상태 (v3.1 - MVP 완료)
다음 기능들은 구현 및 검증이 완료되었습니다:

| 기능 | 상태 | 설명 |
|:--- |:--- |:--- |
| **스마트 음성 녹음** | ✅ 완료 | 실시간 녹음, 시각적 파형, Whisper API 통합 (영어 우선 + 업계 용어 힌트 적용). |
| **텍스트 검증** | ✅ 완료 | 2단계 검증 (변환 → 확인), 텍스트 수정 가능, 사용자 실수 방지 UI. |
| **AI 생성 (V5 Lite)** | ✅ 완료 | GPT-4o 기반 포맷팅, 항목화 (부품/노무비/서비스 분류), 가치 제안 자동 추가($0 항목), 다국어 지원. |
| **PDF 생성** | ✅ 완료 | 전문적인 레이아웃, 합계/세금 자동 계산, 법적 고지 포함, 다운로드 가능. |
| **오프라인 아키텍처** | ✅ 완료 | IndexedDB (Dexie.js) 로컬 저장소, 인터넷 없이 주요 기능 작동 (AI 단계 제외). |
| **동기화 시스템** | ✅ 완료 | Supabase 백그라운드 동기화, 충돌 해결 대기열, RLS 보안 적용. |
| **프로젝트 유형 로직** | ✅ 완료 | 주거용(Residential) vs 상업용(Commercial)에 따른 자재/톤앤매너 조정 로직. |
| **히스토리 관리** | ✅ 완료 | 견적서 조회, 복제, 삭제. 날짜별 검색/정렬. |

### 2.2 즉시 로드맵 (Phase 1: 베타 및 완성도 향상)
초기 베타 테스터 100명을 위한 준비에 집중합니다.

| 우선순위 | 기능 | 요구사항 요약 |
|:--- |:--- |:--- |
| **P0** | **이메일/SMS 통합** | 앱 내에서 PDF를 이메일이나 문자로 직접 전송하는 기능. |
| **P1** | **사용자 피드백 루프** | 베타 테스터가 문제나 제안사항을 보고할 수 있는 앱 내 피드백 메커니즘. |
| **P1** | **버그 수정** | 알려진 Whisper "two 2x4" 인식 문제 및 PDF 빈 문자열 경고 해결. |
| **P2** | **템플릿 관리** | 자주 사용하는 견적 템플릿을 저장하고 불러오는 기능. |

### 2.3 향후 로드맵 (Phase 2 & 3)
수익화 및 확장에 집중합니다.

- **결제**: PDF 내 Stripe "선금 요청(Deposit Request)" 링크 삽입.
- **팀 기능**: 관리자 대시보드가 포함된 다중 사용자 계정.
- **고급 가격 책정**: 지역 기반 자재 가격 데이터베이스 연동.

---

## 3. 사용자 흐름 (User Flows)

### 3.1 "주차장(The Parking Lot)" 흐름 (메인 시나리오)
**목표:** 기술자가 고객의 주차장을 떠나기 전에 견적서 작성을 완료하는 것.

1.  **입력**: 사용자가 앱을 열고(오프라인/온라인), "녹음"을 누른 뒤 작업을 설명합니다.
2.  **확인**: 변환된 텍스트를 검토하고 필요 시 수정합니다.
3.  **처리**:
    *   *온라인인 경우*: 즉시 AI가 처리합니다.
    *   *오프라인인 경우*: 로컬 DB에 저장하고 동기화 대기열에 추가합니다. 사용자에게 "저장됨" 알림을 보냅니다.
4.  **출력**: 서식이 적용된 PDF를 미리보기 합니다.
5.  **실행**: 이메일/문자/링크를 통해 PDF를 공유합니다.

---

## 4. 기술 요구사항

### 4.1 프론트엔드 아키텍처
- **프레임워크**: Next.js 14 (App Router)
- **로컬 데이터베이스**: Dexie.js (IndexedDB 래퍼)
- **상태 관리**: React Query + Local State
- **UI 시스템**: Tailwind CSS + Shadcn UI
- **PWA**: `next-pwa` (설치형 앱 및 오프라인 서비스 워커 지원)

### 4.2 백엔드 및 인프라
- **데이터베이스**: Supabase (PostgreSQL)
- **인증**: Supabase Auth
- **AI 엔진**:
    - STT (음성 텍스트 변환): OpenAI Whisper-V2
    - LLM (거대 언어 모델): OpenAI GPT-4o
- **스토리지**: Supabase Storage (이미지/생성된 PDF 저장)

### 4.3 AI 사양 (Prompt V5 Lite)
- **토큰 제한**: 요청당 약 650 토큰
- **목표 지연 시간**: 5초 미만
- **안전 장치**: $5,000 초과 견적에 대한 강력한 경고 표시
- **교정**: 콩글리시나 서툰 영어를 전문 용어로 자동 교정 (예: "fix toilet" → "Toilet Fixture Repair & Calibration").

---

## 5. 인수 조건 (예정 기능용)

### 5.1 이메일/SMS 전송
- [ ] 사용자가 "미리보기" 모달에서 받는 사람의 이메일/전화번호를 입력할 수 있다.
- [ ] 시스템은 PDF가 첨부(또는 링크)된 트랜잭션 이메일을 발송한다.
- [ ] "전송됨" 상태가 로컬 DB에 기록되고 동기화된다.

### 5.2 피드백 루프
- [ ] 모든 페이지(또는 설정 메뉴)에 떠 있는 "피드백" 버튼이 보인다.
- [ ] 간단한 양식: 평점(1-5), 카테고리(버그/기능), 텍스트 설명.
- [ ] 제출 시 데이터가 Supabase `feedback` 테이블로 전송된다.

---

## 6. 알려진 문제 및 리스크
- **Whisper 환각(Hallucination)**: 침묵 구간에서 반복되거나 숫자를 잘못 해석("to" vs "2")하는 현상. *완화 방안: 클라이언트 측에서 정규식(Regex)을 통한 엄격한 후처리.*
- **동기화 충돌**: 오프라인에서 여러 기기로 수정 시 경쟁 상태 발생 가능. *완화 방안: MVP 단계에서는 '마지막 수정 우선(Last-write-wins)' 정책 적용.*
