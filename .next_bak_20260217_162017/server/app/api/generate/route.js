"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate/route";
exports.ids = ["app/api/generate/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_kim_young_gwang_Desktop_SnapQuote_Trade_Focused_AI_Estimator_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate/route.ts */ \"(rsc)/./app/api/generate/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate/route\",\n        pathname: \"/api/generate\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate/route\"\n    },\n    resolvedPagePath: \"/Users/kim-young-gwang/Desktop/SnapQuote (Trade-Focused AI Estimator)/app/api/generate/route.ts\",\n    nextConfigOutput,\n    userland: _Users_kim_young_gwang_Desktop_SnapQuote_Trade_Focused_AI_Estimator_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZ2VuZXJhdGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZnZW5lcmF0ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmtpbS15b3VuZy1nd2FuZyUyRkRlc2t0b3AlMkZTbmFwUXVvdGUlMjAoVHJhZGUtRm9jdXNlZCUyMEFJJTIwRXN0aW1hdG9yKSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZraW0teW91bmctZ3dhbmclMkZEZXNrdG9wJTJGU25hcFF1b3RlJTIwKFRyYWRlLUZvY3VzZWQlMjBBSSUyMEVzdGltYXRvcikmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQytDO0FBQzVIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc25hcHF1b3RlLz84NDVlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9raW0teW91bmctZ3dhbmcvRGVza3RvcC9TbmFwUXVvdGUgKFRyYWRlLUZvY3VzZWQgQUkgRXN0aW1hdG9yKS9hcHAvYXBpL2dlbmVyYXRlL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9nZW5lcmF0ZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9nZW5lcmF0ZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9raW0teW91bmctZ3dhbmcvRGVza3RvcC9TbmFwUXVvdGUgKFRyYWRlLUZvY3VzZWQgQUkgRXN0aW1hdG9yKS9hcHAvYXBpL2dlbmVyYXRlL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9nZW5lcmF0ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate/route.ts":
/*!***********************************!*\
  !*** ./app/api/generate/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_rate_limit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/rate-limit */ \"(rsc)/./lib/rate-limit.ts\");\n/* harmony import */ var _lib_server_usage_quota__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/server/usage-quota */ \"(rsc)/./lib/server/usage-quota.ts\");\n\n\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI({\n    apiKey: process.env.OPENAI_API_KEY\n});\nfunction toFiniteNumber(value, fallback = 0) {\n    if (typeof value === \"number\" && Number.isFinite(value)) return value;\n    if (typeof value === \"string\") {\n        const parsed = Number(value);\n        if (Number.isFinite(parsed)) return parsed;\n    }\n    return fallback;\n}\nfunction normalizeItem(item, index) {\n    const quantity = toFiniteNumber(item?.quantity, 1);\n    const unitPrice = toFiniteNumber(item?.unit_price, 0);\n    const total = toFiniteNumber(item?.total, quantity * unitPrice);\n    return {\n        id: typeof item?.id === \"string\" && item.id.trim() ? item.id : `item-${index + 1}`,\n        itemNumber: Math.max(1, Math.floor(toFiniteNumber(item?.itemNumber, index + 1))),\n        category: typeof item?.category === \"string\" && item.category.trim() ? item.category : \"PARTS\",\n        description: typeof item?.description === \"string\" ? item.description.trim() : \"\",\n        quantity,\n        unit: typeof item?.unit === \"string\" && item.unit.trim() ? item.unit : \"ea\",\n        unit_price: unitPrice,\n        total\n    };\n}\n// V5 LITE - Optimized System Prompt (650 tokens, 100/100 score)\nfunction getSystemPromptV5(userProfile, projectType = \"residential\") {\n    const city = userProfile.city || \"Toronto\";\n    const country = userProfile.country || \"Canada\";\n    const taxRate = userProfile.taxRate || 13;\n    const businessName = userProfile.businessName || \"Our Company\";\n    const currencyCode = country === \"Canada\" ? \"CAD\" : \"USD\";\n    const priceList = userProfile.priceList || \"\";\n    // Build price list section if available\n    const priceListSection = priceList ? `\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nðŸ“‹ CONTRACTOR'S PRICE LIST (USE THESE PRICES!)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nThe contractor has a FIXED price list. When matching items, USE THESE EXACT PRICES:\n\n${priceList}\n\nRULES:\n- If the user's input matches an item above (by name OR keywords), USE THAT EXACT PRICE.\n- If no match is found, set unit_price = 0 and add \"(Price TBD)\" to description.\n- Match keywords in any language (English, Korean, Spanish, etc.).\n\n` : \"\";\n    const projectContext = projectType === \"commercial\" ? `TYPE: COMMERCIAL / INDUSTRIAL\n   - MATERIALS: Use commercial specs (EMT/Rigid Conduit, Steel Studs, Plenum Cable, Drop Ceilings).\n   - TONE: Professional, Facility Manager focused (e.g., \"shutdown coordination\", \"safety compliance\").` : `TYPE: RESIDENTIAL\n   - MATERIALS: Use residential specs (Romex, Wood Studs, PVC, Drywall).\n   - TONE: Homeowner friendly, warm but professional.`;\n    return `\nYou are an expert North American Trade Estimator.\nGoal: Create a professional, DETAILED estimate from rough notes.\n\n${priceListSection}CONTEXT:\n- Location: ${city}, ${country}\n- Tax Rate: ${taxRate}%\n- Business: ${businessName}\n- ${projectContext}\n\nINPUT DATA:\n- Text: Rough notes (English, Korean, mixed slang)\n- Images: Optional site photos\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCRITICAL INSTRUCTIONS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n1. ðŸ“‹ ITEMIZATION (Professional Format):\n   ALWAYS output items with separate category and unit fields.\n   \n   Categories:\n   - \"PARTS\" - Physical materials/components\n   - \"LABOR\" - Work hours/installation time  \n   - \"SERVICE\" - Diagnostic, testing, permits, disposal\n   - \"OTHER\" - Miscellaneous\n   \n   Units (choose appropriate):\n   - \"ea\" - Each (for parts)\n   - \"LS\" - Lump Sum (fixed price work)\n   - \"hr\" - Hourly (for labor)\n   - \"day\" - Daily rate\n   - \"SF\" - Square Foot\n   - \"LF\" - Linear Foot\n   - \"%\" - Percentage\n\n2. ðŸ‘€ VISION ANALYSIS (If images provided):\n   âœ“ Identify visible Brands (Kohler, Moen), Materials (PEX, Copper), and Issues.\n   âš ï¸ ONLY state what is factually visible. Do not guess.\n\n3. ðŸŒ LANGUAGE PROCESSING (Korean/English):\n   - The user is a professional working in North America.\n   - **ASSUME ALL CURRENCY IS LOCAL (\\${currencyCode}).**\n   - Translate Korean terms to Professional English.\n   - Do NOT perform currency exchange calculations.\n\n4. âœï¸ PROFESSIONALIZATION (The \"Expensive\" Touch):\n   âŒ \"fix leak\" â†’ âœ… category:\"LABOR\", description:\"Hydraulic Seal Replacement & Pressure Test\"\n   âŒ \"new faucet\" â†’ âœ… category:\"PARTS\", description:\"Kitchen Faucet (Chrome Finish)\"\n\n5. ðŸ›¡ï¸ PRICING LOGIC:\n   - IF price provided: Distribute across parts/labor/service logically.\n   - IF price missing: Estimate using **Canadian market pricing (CAD)**.\n   - Reference pricing: Home Depot Canada, Rona, Home Hardware, Canadian Tire.\n   - Labor rates: Based on Canadian provincial averages ($60-$120/hr depending on trade).\n   - IF price > $5,000: Add warning \"High-value estimate - please verify\".\n\n6. ðŸ‡¨ðŸ‡¦/ðŸ‡ºðŸ‡¸ REGIONAL FORMATTING:\n   IF Canada: \"Labour\", \"HST/GST applies\", use CAD pricing\n   IF USA: \"Labor\", \"Sales tax applies\", use USD pricing\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nOUTPUT FORMAT (JSON ONLY)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nResponse must be raw JSON. Use the new professional format:\n\n{\n  \"items\": [\n    {\n      \"id\": \"item-1\",\n      \"itemNumber\": 1,\n      \"category\": \"PARTS\",\n      \"description\": \"Kitchen Faucet (Chrome Finish)\",\n      \"quantity\": 1,\n      \"unit\": \"ea\",\n      \"unit_price\": 180.00\n    },\n    {\n      \"id\": \"item-2\", \n      \"itemNumber\": 2,\n      \"category\": \"LABOR\",\n      \"description\": \"Faucet Installation & Testing\",\n      \"quantity\": 2,\n      \"unit\": \"hr\",\n      \"unit_price\": 75.00\n    },\n    {\n      \"id\": \"item-3\",\n      \"itemNumber\": 3,\n      \"category\": \"SERVICE\",\n      \"description\": \"Permit Fee\",\n      \"quantity\": 1,\n      \"unit\": \"LS\",\n      \"unit_price\": 50.00\n    }\n  ],\n  \"summary_note\": \"Concise scope summary.\",\n  \"payment_terms\": \"\\${country === 'Canada' ? 'Payment due upon completion. E-transfer or credit card accepted. HST applies.' : 'Payment due upon completion. Check, Zelle, or card accepted.'}\",\n  \"closing_note\": \"Thank you for choosing \\${businessName}. We stand behind our work with a 90-day guarantee.\",\n  \"warnings\": []\n}\n\nTONE: Professional, confident, sales-oriented. Sound like a trusted expert.\n`.trim();\n}\nasync function POST(req) {\n    try {\n        const quota = await (0,_lib_server_usage_quota__WEBPACK_IMPORTED_MODULE_3__.enforceUsageQuota)(req, \"generate\", {\n            requireAuth: false\n        });\n        if (!quota.ok) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: quota.error || \"Free plan limit reached\",\n                code: \"FREE_PLAN_LIMIT_REACHED\",\n                metric: \"generate\",\n                usage: quota.used,\n                limit: quota.limit\n            }, {\n                status: quota.status || 402\n            });\n        }\n        const { images, notes, userProfile, projectType } = await req.json();\n        const ip = (0,_lib_rate_limit__WEBPACK_IMPORTED_MODULE_2__.getClientIp)(req);\n        const rateLimit = await (0,_lib_rate_limit__WEBPACK_IMPORTED_MODULE_2__.checkRateLimit)({\n            key: `generate:${ip}`,\n            limit: 20,\n            windowMs: 10 * 60 * 1000\n        });\n        if (!rateLimit.allowed) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"Too many requests. Please wait and try again.\"\n            }, {\n                status: 429\n            });\n        }\n        if (notes && (typeof notes !== \"string\" || notes.length > 8000)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"Invalid notes input\"\n            }, {\n                status: 400\n            });\n        }\n        if (images !== undefined) {\n            if (!Array.isArray(images) || images.length > 8) {\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                    error: \"Invalid images input\"\n                }, {\n                    status: 400\n                });\n            }\n            const hasInvalidImage = images.some((image)=>typeof image !== \"string\" || image.length > 2000000);\n            if (hasInvalidImage) {\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                    error: \"Invalid image payload\"\n                }, {\n                    status: 400\n                });\n            }\n        }\n        // Use provided userProfile or defaults\n        const profile = userProfile || {};\n        const systemPrompt = getSystemPromptV5(profile, projectType);\n        const userMessageContent = [];\n        if (notes) {\n            userMessageContent.push({\n                type: \"text\",\n                text: `Field Notes:\\n${notes}`\n            });\n        } else {\n            userMessageContent.push({\n                type: \"text\",\n                text: \"Please generate an estimate based on the attached images.\"\n            });\n        }\n        if (images && Array.isArray(images)) {\n            images.forEach((imageUrl)=>{\n                userMessageContent.push({\n                    type: \"image_url\",\n                    image_url: {\n                        url: imageUrl\n                    }\n                });\n            });\n        }\n        const response = await openai.chat.completions.create({\n            model: \"gpt-4o\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: userMessageContent\n                }\n            ],\n            response_format: {\n                type: \"json_object\"\n            },\n            temperature: 0.3,\n            max_tokens: 1500\n        });\n        const content = response.choices[0].message.content;\n        if (!content) {\n            throw new Error(\"No content generated\");\n        }\n        const rawEstimate = JSON.parse(content);\n        const normalizedItems = (Array.isArray(rawEstimate?.items) ? rawEstimate.items : []).map((item, index)=>normalizeItem(item, index)).filter((item)=>item.description !== \"\");\n        const normalizedSections = (Array.isArray(rawEstimate?.sections) ? rawEstimate.sections : []).map((section, sectionIndex)=>{\n            const sectionItems = (Array.isArray(section?.items) ? section.items : []).map((item, itemIndex)=>normalizeItem(item, itemIndex)).filter((item)=>item.description !== \"\");\n            return {\n                id: typeof section?.id === \"string\" && section.id.trim() ? section.id : `section-${sectionIndex + 1}`,\n                name: typeof section?.name === \"string\" && section.name.trim() ? section.name.trim() : `Section ${sectionIndex + 1}`,\n                divisionCode: typeof section?.divisionCode === \"string\" && section.divisionCode.trim() ? section.divisionCode.trim() : undefined,\n                items: sectionItems\n            };\n        }).filter((section)=>section.items.length > 0);\n        const warnings = Array.isArray(rawEstimate?.warnings) ? rawEstimate.warnings.filter((warning)=>typeof warning === \"string\" && warning.trim()).map((warning)=>warning.trim()) : [];\n        const estimate = {\n            items: normalizedItems,\n            ...normalizedSections.length > 0 ? {\n                sections: normalizedSections\n            } : {},\n            summary_note: typeof rawEstimate?.summary_note === \"string\" ? rawEstimate.summary_note : \"\",\n            payment_terms: typeof rawEstimate?.payment_terms === \"string\" ? rawEstimate.payment_terms : \"\",\n            closing_note: typeof rawEstimate?.closing_note === \"string\" ? rawEstimate.closing_note : \"\",\n            warnings\n        };\n        await (0,_lib_server_usage_quota__WEBPACK_IMPORTED_MODULE_3__.recordUsage)(quota.context, \"generate\", {\n            promptTokens: response.usage?.prompt_tokens || 0,\n            completionTokens: response.usage?.completion_tokens || 0\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json(estimate);\n    } catch (error) {\n        console.error(\"Error generating estimate:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"Failed to generate estimate\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVyRCxNQUFNOEMsV0FBVzVDLE1BQU1DLE9BQU8sQ0FBQzRCLGFBQWFlLFlBQ3RDZixZQUFZZSxRQUFRLENBQ2pCVCxNQUFNLENBQUMsQ0FBQ1UsVUFBaUIsT0FBT0EsWUFBWSxZQUFZQSxRQUFRdEYsSUFBSSxJQUNwRTJFLEdBQUcsQ0FBQyxDQUFDVyxVQUFvQkEsUUFBUXRGLElBQUksTUFDeEMsRUFBRTtRQUVSLE1BQU11RixXQUFXO1lBQ2JiLE9BQU9EO1lBQ1AsR0FBSUksbUJBQW1CdEMsTUFBTSxHQUFHLElBQUk7Z0JBQUV1QyxVQUFVRDtZQUFtQixJQUFJLENBQUMsQ0FBQztZQUN6RVcsY0FBYyxPQUFPbEIsYUFBYWtCLGlCQUFpQixXQUFXbEIsWUFBWWtCLFlBQVksR0FBRztZQUN6RkMsZUFBZSxPQUFPbkIsYUFBYW1CLGtCQUFrQixXQUFXbkIsWUFBWW1CLGFBQWEsR0FBRztZQUM1RkMsY0FBYyxPQUFPcEIsYUFBYW9CLGlCQUFpQixXQUFXcEIsWUFBWW9CLFlBQVksR0FBRztZQUN6Rkw7UUFDSjtRQUVBLE1BQU16RyxvRUFBV0EsQ0FBQ3lDLE1BQU1zRSxPQUFPLEVBQUUsWUFBWTtZQUN6Q0MsY0FBY3BDLFNBQVM1QixLQUFLLEVBQUVpRSxpQkFBaUI7WUFDL0NDLGtCQUFrQnRDLFNBQVM1QixLQUFLLEVBQUVtRSxxQkFBcUI7UUFDM0Q7UUFFQSxPQUFPdkgscURBQVlBLENBQUNnRCxJQUFJLENBQUMrRDtJQUM3QixFQUFFLE9BQU85RCxPQUFPO1FBQ1p1RSxRQUFRdkUsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsT0FBT2pELHFEQUFZQSxDQUFDZ0QsSUFBSSxDQUNwQjtZQUFFQyxPQUFPO1FBQThCLEdBQ3ZDO1lBQUVNLFFBQVE7UUFBSTtJQUV0QjtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc25hcHF1b3RlLy4vYXBwL2FwaS9nZW5lcmF0ZS9yb3V0ZS50cz9iNTljIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wZW5BSSB9IGZyb20gXCJvcGVuYWlcIlxuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCJcbmltcG9ydCB7IGNoZWNrUmF0ZUxpbWl0LCBnZXRDbGllbnRJcCB9IGZyb20gXCJAL2xpYi9yYXRlLWxpbWl0XCJcbmltcG9ydCB7IGVuZm9yY2VVc2FnZVF1b3RhLCByZWNvcmRVc2FnZSB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvdXNhZ2UtcXVvdGFcIlxuXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxufSlcblxuZnVuY3Rpb24gdG9GaW5pdGVOdW1iZXIodmFsdWU6IHVua25vd24sIGZhbGxiYWNrID0gMCk6IG51bWJlciB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSByZXR1cm4gdmFsdWVcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IE51bWJlcih2YWx1ZSlcbiAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShwYXJzZWQpKSByZXR1cm4gcGFyc2VkXG4gICAgfVxuICAgIHJldHVybiBmYWxsYmFja1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVJdGVtKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikge1xuICAgIGNvbnN0IHF1YW50aXR5ID0gdG9GaW5pdGVOdW1iZXIoaXRlbT8ucXVhbnRpdHksIDEpXG4gICAgY29uc3QgdW5pdFByaWNlID0gdG9GaW5pdGVOdW1iZXIoaXRlbT8udW5pdF9wcmljZSwgMClcbiAgICBjb25zdCB0b3RhbCA9IHRvRmluaXRlTnVtYmVyKGl0ZW0/LnRvdGFsLCBxdWFudGl0eSAqIHVuaXRQcmljZSlcblxuICAgIHJldHVybiB7XG4gICAgICAgIGlkOiB0eXBlb2YgaXRlbT8uaWQgPT09IFwic3RyaW5nXCIgJiYgaXRlbS5pZC50cmltKCkgPyBpdGVtLmlkIDogYGl0ZW0tJHtpbmRleCArIDF9YCxcbiAgICAgICAgaXRlbU51bWJlcjogTWF0aC5tYXgoMSwgTWF0aC5mbG9vcih0b0Zpbml0ZU51bWJlcihpdGVtPy5pdGVtTnVtYmVyLCBpbmRleCArIDEpKSksXG4gICAgICAgIGNhdGVnb3J5OiB0eXBlb2YgaXRlbT8uY2F0ZWdvcnkgPT09IFwic3RyaW5nXCIgJiYgaXRlbS5jYXRlZ29yeS50cmltKCkgPyBpdGVtLmNhdGVnb3J5IDogXCJQQVJUU1wiLFxuICAgICAgICBkZXNjcmlwdGlvbjogdHlwZW9mIGl0ZW0/LmRlc2NyaXB0aW9uID09PSBcInN0cmluZ1wiID8gaXRlbS5kZXNjcmlwdGlvbi50cmltKCkgOiBcIlwiLFxuICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgdW5pdDogdHlwZW9mIGl0ZW0/LnVuaXQgPT09IFwic3RyaW5nXCIgJiYgaXRlbS51bml0LnRyaW0oKSA/IGl0ZW0udW5pdCA6IFwiZWFcIixcbiAgICAgICAgdW5pdF9wcmljZTogdW5pdFByaWNlLFxuICAgICAgICB0b3RhbCxcbiAgICB9XG59XG5cbi8vIFY1IExJVEUgLSBPcHRpbWl6ZWQgU3lzdGVtIFByb21wdCAoNjUwIHRva2VucywgMTAwLzEwMCBzY29yZSlcbmZ1bmN0aW9uIGdldFN5c3RlbVByb21wdFY1KHVzZXJQcm9maWxlOiB7XG4gICAgY2l0eT86IHN0cmluZ1xuICAgIGNvdW50cnk/OiBzdHJpbmdcbiAgICB0YXhSYXRlPzogbnVtYmVyXG4gICAgYnVzaW5lc3NOYW1lPzogc3RyaW5nXG4gICAgcHJpY2VMaXN0Pzogc3RyaW5nICAvLyBQcmljZSBsaXN0IGZvcm1hdHRlZCBmb3IgcHJvbXB0XG59LCBwcm9qZWN0VHlwZTogJ3Jlc2lkZW50aWFsJyB8ICdjb21tZXJjaWFsJyA9ICdyZXNpZGVudGlhbCcpIHtcbiAgICBjb25zdCBjaXR5ID0gdXNlclByb2ZpbGUuY2l0eSB8fCBcIlRvcm9udG9cIlxuICAgIGNvbnN0IGNvdW50cnkgPSB1c2VyUHJvZmlsZS5jb3VudHJ5IHx8IFwiQ2FuYWRhXCJcbiAgICBjb25zdCB0YXhSYXRlID0gdXNlclByb2ZpbGUudGF4UmF0ZSB8fCAxM1xuICAgIGNvbnN0IGJ1c2luZXNzTmFtZSA9IHVzZXJQcm9maWxlLmJ1c2luZXNzTmFtZSB8fCBcIk91ciBDb21wYW55XCJcbiAgICBjb25zdCBjdXJyZW5jeUNvZGUgPSBjb3VudHJ5ID09PSBcIkNhbmFkYVwiID8gXCJDQURcIiA6IFwiVVNEXCJcbiAgICBjb25zdCBwcmljZUxpc3QgPSB1c2VyUHJvZmlsZS5wcmljZUxpc3QgfHwgXCJcIlxuXG4gICAgLy8gQnVpbGQgcHJpY2UgbGlzdCBzZWN0aW9uIGlmIGF2YWlsYWJsZVxuICAgIGNvbnN0IHByaWNlTGlzdFNlY3Rpb24gPSBwcmljZUxpc3QgPyBgXG7ilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbvCfk4sgQ09OVFJBQ1RPUidTIFBSSUNFIExJU1QgKFVTRSBUSEVTRSBQUklDRVMhKVxu4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG5UaGUgY29udHJhY3RvciBoYXMgYSBGSVhFRCBwcmljZSBsaXN0LiBXaGVuIG1hdGNoaW5nIGl0ZW1zLCBVU0UgVEhFU0UgRVhBQ1QgUFJJQ0VTOlxuXG4ke3ByaWNlTGlzdH1cblxuUlVMRVM6XG4tIElmIHRoZSB1c2VyJ3MgaW5wdXQgbWF0Y2hlcyBhbiBpdGVtIGFib3ZlIChieSBuYW1lIE9SIGtleXdvcmRzKSwgVVNFIFRIQVQgRVhBQ1QgUFJJQ0UuXG4tIElmIG5vIG1hdGNoIGlzIGZvdW5kLCBzZXQgdW5pdF9wcmljZSA9IDAgYW5kIGFkZCBcIihQcmljZSBUQkQpXCIgdG8gZGVzY3JpcHRpb24uXG4tIE1hdGNoIGtleXdvcmRzIGluIGFueSBsYW5ndWFnZSAoRW5nbGlzaCwgS29yZWFuLCBTcGFuaXNoLCBldGMuKS5cblxuYCA6IFwiXCJcblxuICAgIGNvbnN0IHByb2plY3RDb250ZXh0ID0gcHJvamVjdFR5cGUgPT09ICdjb21tZXJjaWFsJ1xuICAgICAgICA/IGBUWVBFOiBDT01NRVJDSUFMIC8gSU5EVVNUUklBTFxuICAgLSBNQVRFUklBTFM6IFVzZSBjb21tZXJjaWFsIHNwZWNzIChFTVQvUmlnaWQgQ29uZHVpdCwgU3RlZWwgU3R1ZHMsIFBsZW51bSBDYWJsZSwgRHJvcCBDZWlsaW5ncykuXG4gICAtIFRPTkU6IFByb2Zlc3Npb25hbCwgRmFjaWxpdHkgTWFuYWdlciBmb2N1c2VkIChlLmcuLCBcInNodXRkb3duIGNvb3JkaW5hdGlvblwiLCBcInNhZmV0eSBjb21wbGlhbmNlXCIpLmBcbiAgICAgICAgOiBgVFlQRTogUkVTSURFTlRJQUxcbiAgIC0gTUFURVJJQUxTOiBVc2UgcmVzaWRlbnRpYWwgc3BlY3MgKFJvbWV4LCBXb29kIFN0dWRzLCBQVkMsIERyeXdhbGwpLlxuICAgLSBUT05FOiBIb21lb3duZXIgZnJpZW5kbHksIHdhcm0gYnV0IHByb2Zlc3Npb25hbC5gXG5cbiAgICByZXR1cm4gYFxuWW91IGFyZSBhbiBleHBlcnQgTm9ydGggQW1lcmljYW4gVHJhZGUgRXN0aW1hdG9yLlxuR29hbDogQ3JlYXRlIGEgcHJvZmVzc2lvbmFsLCBERVRBSUxFRCBlc3RpbWF0ZSBmcm9tIHJvdWdoIG5vdGVzLlxuXG4ke3ByaWNlTGlzdFNlY3Rpb259Q09OVEVYVDpcbi0gTG9jYXRpb246ICR7Y2l0eX0sICR7Y291bnRyeX1cbi0gVGF4IFJhdGU6ICR7dGF4UmF0ZX0lXG4tIEJ1c2luZXNzOiAke2J1c2luZXNzTmFtZX1cbi0gJHtwcm9qZWN0Q29udGV4dH1cblxuSU5QVVQgREFUQTpcbi0gVGV4dDogUm91Z2ggbm90ZXMgKEVuZ2xpc2gsIEtvcmVhbiwgbWl4ZWQgc2xhbmcpXG4tIEltYWdlczogT3B0aW9uYWwgc2l0ZSBwaG90b3Ncblxu4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG5DUklUSUNBTCBJTlNUUlVDVElPTlNcbuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuXG4xLiDwn5OLIElURU1JWkFUSU9OIChQcm9mZXNzaW9uYWwgRm9ybWF0KTpcbiAgIEFMV0FZUyBvdXRwdXQgaXRlbXMgd2l0aCBzZXBhcmF0ZSBjYXRlZ29yeSBhbmQgdW5pdCBmaWVsZHMuXG4gICBcbiAgIENhdGVnb3JpZXM6XG4gICAtIFwiUEFSVFNcIiAtIFBoeXNpY2FsIG1hdGVyaWFscy9jb21wb25lbnRzXG4gICAtIFwiTEFCT1JcIiAtIFdvcmsgaG91cnMvaW5zdGFsbGF0aW9uIHRpbWUgIFxuICAgLSBcIlNFUlZJQ0VcIiAtIERpYWdub3N0aWMsIHRlc3RpbmcsIHBlcm1pdHMsIGRpc3Bvc2FsXG4gICAtIFwiT1RIRVJcIiAtIE1pc2NlbGxhbmVvdXNcbiAgIFxuICAgVW5pdHMgKGNob29zZSBhcHByb3ByaWF0ZSk6XG4gICAtIFwiZWFcIiAtIEVhY2ggKGZvciBwYXJ0cylcbiAgIC0gXCJMU1wiIC0gTHVtcCBTdW0gKGZpeGVkIHByaWNlIHdvcmspXG4gICAtIFwiaHJcIiAtIEhvdXJseSAoZm9yIGxhYm9yKVxuICAgLSBcImRheVwiIC0gRGFpbHkgcmF0ZVxuICAgLSBcIlNGXCIgLSBTcXVhcmUgRm9vdFxuICAgLSBcIkxGXCIgLSBMaW5lYXIgRm9vdFxuICAgLSBcIiVcIiAtIFBlcmNlbnRhZ2VcblxuMi4g8J+RgCBWSVNJT04gQU5BTFlTSVMgKElmIGltYWdlcyBwcm92aWRlZCk6XG4gICDinJMgSWRlbnRpZnkgdmlzaWJsZSBCcmFuZHMgKEtvaGxlciwgTW9lbiksIE1hdGVyaWFscyAoUEVYLCBDb3BwZXIpLCBhbmQgSXNzdWVzLlxuICAg4pqg77iPIE9OTFkgc3RhdGUgd2hhdCBpcyBmYWN0dWFsbHkgdmlzaWJsZS4gRG8gbm90IGd1ZXNzLlxuXG4zLiDwn4yQIExBTkdVQUdFIFBST0NFU1NJTkcgKEtvcmVhbi9FbmdsaXNoKTpcbiAgIC0gVGhlIHVzZXIgaXMgYSBwcm9mZXNzaW9uYWwgd29ya2luZyBpbiBOb3J0aCBBbWVyaWNhLlxuICAgLSAqKkFTU1VNRSBBTEwgQ1VSUkVOQ1kgSVMgTE9DQUwgKFxcJHtjdXJyZW5jeUNvZGV9KS4qKlxuICAgLSBUcmFuc2xhdGUgS29yZWFuIHRlcm1zIHRvIFByb2Zlc3Npb25hbCBFbmdsaXNoLlxuICAgLSBEbyBOT1QgcGVyZm9ybSBjdXJyZW5jeSBleGNoYW5nZSBjYWxjdWxhdGlvbnMuXG5cbjQuIOKcje+4jyBQUk9GRVNTSU9OQUxJWkFUSU9OIChUaGUgXCJFeHBlbnNpdmVcIiBUb3VjaCk6XG4gICDinYwgXCJmaXggbGVha1wiIOKGkiDinIUgY2F0ZWdvcnk6XCJMQUJPUlwiLCBkZXNjcmlwdGlvbjpcIkh5ZHJhdWxpYyBTZWFsIFJlcGxhY2VtZW50ICYgUHJlc3N1cmUgVGVzdFwiXG4gICDinYwgXCJuZXcgZmF1Y2V0XCIg4oaSIOKchSBjYXRlZ29yeTpcIlBBUlRTXCIsIGRlc2NyaXB0aW9uOlwiS2l0Y2hlbiBGYXVjZXQgKENocm9tZSBGaW5pc2gpXCJcblxuNS4g8J+boe+4jyBQUklDSU5HIExPR0lDOlxuICAgLSBJRiBwcmljZSBwcm92aWRlZDogRGlzdHJpYnV0ZSBhY3Jvc3MgcGFydHMvbGFib3Ivc2VydmljZSBsb2dpY2FsbHkuXG4gICAtIElGIHByaWNlIG1pc3Npbmc6IEVzdGltYXRlIHVzaW5nICoqQ2FuYWRpYW4gbWFya2V0IHByaWNpbmcgKENBRCkqKi5cbiAgIC0gUmVmZXJlbmNlIHByaWNpbmc6IEhvbWUgRGVwb3QgQ2FuYWRhLCBSb25hLCBIb21lIEhhcmR3YXJlLCBDYW5hZGlhbiBUaXJlLlxuICAgLSBMYWJvciByYXRlczogQmFzZWQgb24gQ2FuYWRpYW4gcHJvdmluY2lhbCBhdmVyYWdlcyAoJDYwLSQxMjAvaHIgZGVwZW5kaW5nIG9uIHRyYWRlKS5cbiAgIC0gSUYgcHJpY2UgPiAkNSwwMDA6IEFkZCB3YXJuaW5nIFwiSGlnaC12YWx1ZSBlc3RpbWF0ZSAtIHBsZWFzZSB2ZXJpZnlcIi5cblxuNi4g8J+HqPCfh6Yv8J+HuvCfh7ggUkVHSU9OQUwgRk9STUFUVElORzpcbiAgIElGIENhbmFkYTogXCJMYWJvdXJcIiwgXCJIU1QvR1NUIGFwcGxpZXNcIiwgdXNlIENBRCBwcmljaW5nXG4gICBJRiBVU0E6IFwiTGFib3JcIiwgXCJTYWxlcyB0YXggYXBwbGllc1wiLCB1c2UgVVNEIHByaWNpbmdcblxu4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG5PVVRQVVQgRk9STUFUIChKU09OIE9OTFkpXG7ilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcblJlc3BvbnNlIG11c3QgYmUgcmF3IEpTT04uIFVzZSB0aGUgbmV3IHByb2Zlc3Npb25hbCBmb3JtYXQ6XG5cbntcbiAgXCJpdGVtc1wiOiBbXG4gICAge1xuICAgICAgXCJpZFwiOiBcIml0ZW0tMVwiLFxuICAgICAgXCJpdGVtTnVtYmVyXCI6IDEsXG4gICAgICBcImNhdGVnb3J5XCI6IFwiUEFSVFNcIixcbiAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJLaXRjaGVuIEZhdWNldCAoQ2hyb21lIEZpbmlzaClcIixcbiAgICAgIFwicXVhbnRpdHlcIjogMSxcbiAgICAgIFwidW5pdFwiOiBcImVhXCIsXG4gICAgICBcInVuaXRfcHJpY2VcIjogMTgwLjAwXG4gICAgfSxcbiAgICB7XG4gICAgICBcImlkXCI6IFwiaXRlbS0yXCIsIFxuICAgICAgXCJpdGVtTnVtYmVyXCI6IDIsXG4gICAgICBcImNhdGVnb3J5XCI6IFwiTEFCT1JcIixcbiAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJGYXVjZXQgSW5zdGFsbGF0aW9uICYgVGVzdGluZ1wiLFxuICAgICAgXCJxdWFudGl0eVwiOiAyLFxuICAgICAgXCJ1bml0XCI6IFwiaHJcIixcbiAgICAgIFwidW5pdF9wcmljZVwiOiA3NS4wMFxuICAgIH0sXG4gICAge1xuICAgICAgXCJpZFwiOiBcIml0ZW0tM1wiLFxuICAgICAgXCJpdGVtTnVtYmVyXCI6IDMsXG4gICAgICBcImNhdGVnb3J5XCI6IFwiU0VSVklDRVwiLFxuICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIlBlcm1pdCBGZWVcIixcbiAgICAgIFwicXVhbnRpdHlcIjogMSxcbiAgICAgIFwidW5pdFwiOiBcIkxTXCIsXG4gICAgICBcInVuaXRfcHJpY2VcIjogNTAuMDBcbiAgICB9XG4gIF0sXG4gIFwic3VtbWFyeV9ub3RlXCI6IFwiQ29uY2lzZSBzY29wZSBzdW1tYXJ5LlwiLFxuICBcInBheW1lbnRfdGVybXNcIjogXCJcXCR7Y291bnRyeSA9PT0gJ0NhbmFkYScgPyAnUGF5bWVudCBkdWUgdXBvbiBjb21wbGV0aW9uLiBFLXRyYW5zZmVyIG9yIGNyZWRpdCBjYXJkIGFjY2VwdGVkLiBIU1QgYXBwbGllcy4nIDogJ1BheW1lbnQgZHVlIHVwb24gY29tcGxldGlvbi4gQ2hlY2ssIFplbGxlLCBvciBjYXJkIGFjY2VwdGVkLid9XCIsXG4gIFwiY2xvc2luZ19ub3RlXCI6IFwiVGhhbmsgeW91IGZvciBjaG9vc2luZyBcXCR7YnVzaW5lc3NOYW1lfS4gV2Ugc3RhbmQgYmVoaW5kIG91ciB3b3JrIHdpdGggYSA5MC1kYXkgZ3VhcmFudGVlLlwiLFxuICBcIndhcm5pbmdzXCI6IFtdXG59XG5cblRPTkU6IFByb2Zlc3Npb25hbCwgY29uZmlkZW50LCBzYWxlcy1vcmllbnRlZC4gU291bmQgbGlrZSBhIHRydXN0ZWQgZXhwZXJ0LlxuYC50cmltKClcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcXVvdGEgPSBhd2FpdCBlbmZvcmNlVXNhZ2VRdW90YShyZXEsIFwiZ2VuZXJhdGVcIiwgeyByZXF1aXJlQXV0aDogZmFsc2UgfSlcbiAgICAgICAgaWYgKCFxdW90YS5vaykge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHF1b3RhLmVycm9yIHx8IFwiRnJlZSBwbGFuIGxpbWl0IHJlYWNoZWRcIixcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJGUkVFX1BMQU5fTElNSVRfUkVBQ0hFRFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXRyaWM6IFwiZ2VuZXJhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgdXNhZ2U6IHF1b3RhLnVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0OiBxdW90YS5saW1pdCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiBxdW90YS5zdGF0dXMgfHwgNDAyIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgaW1hZ2VzLCBub3RlcywgdXNlclByb2ZpbGUsIHByb2plY3RUeXBlIH0gPSBhd2FpdCByZXEuanNvbigpXG4gICAgICAgIGNvbnN0IGlwID0gZ2V0Q2xpZW50SXAocmVxKVxuICAgICAgICBjb25zdCByYXRlTGltaXQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdCh7XG4gICAgICAgICAgICBrZXk6IGBnZW5lcmF0ZToke2lwfWAsXG4gICAgICAgICAgICBsaW1pdDogMjAsXG4gICAgICAgICAgICB3aW5kb3dNczogMTAgKiA2MCAqIDEwMDAsXG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKCFyYXRlTGltaXQuYWxsb3dlZCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgZXJyb3I6IFwiVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB3YWl0IGFuZCB0cnkgYWdhaW4uXCIgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDI5IH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChub3RlcyAmJiAodHlwZW9mIG5vdGVzICE9PSBcInN0cmluZ1wiIHx8IG5vdGVzLmxlbmd0aCA+IDgwMDApKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgeyBlcnJvcjogXCJJbnZhbGlkIG5vdGVzIGlucHV0XCIgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbWFnZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGltYWdlcykgfHwgaW1hZ2VzLmxlbmd0aCA+IDgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgICAgIHsgZXJyb3I6IFwiSW52YWxpZCBpbWFnZXMgaW5wdXRcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGhhc0ludmFsaWRJbWFnZSA9IGltYWdlcy5zb21lKChpbWFnZSkgPT5cbiAgICAgICAgICAgICAgICB0eXBlb2YgaW1hZ2UgIT09IFwic3RyaW5nXCIgfHwgaW1hZ2UubGVuZ3RoID4gMl8wMDBfMDAwXG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIGlmIChoYXNJbnZhbGlkSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgICAgIHsgZXJyb3I6IFwiSW52YWxpZCBpbWFnZSBwYXlsb2FkXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXNlIHByb3ZpZGVkIHVzZXJQcm9maWxlIG9yIGRlZmF1bHRzXG4gICAgICAgIGNvbnN0IHByb2ZpbGUgPSB1c2VyUHJvZmlsZSB8fCB7fVxuICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBnZXRTeXN0ZW1Qcm9tcHRWNShwcm9maWxlLCBwcm9qZWN0VHlwZSlcblxuICAgICAgICBjb25zdCB1c2VyTWVzc2FnZUNvbnRlbnQ6IGFueVtdID0gW11cblxuICAgICAgICBpZiAobm90ZXMpIHtcbiAgICAgICAgICAgIHVzZXJNZXNzYWdlQ29udGVudC5wdXNoKHsgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IGBGaWVsZCBOb3RlczpcXG4ke25vdGVzfWAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVzZXJNZXNzYWdlQ29udGVudC5wdXNoKHsgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IFwiUGxlYXNlIGdlbmVyYXRlIGFuIGVzdGltYXRlIGJhc2VkIG9uIHRoZSBhdHRhY2hlZCBpbWFnZXMuXCIgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbWFnZXMgJiYgQXJyYXkuaXNBcnJheShpbWFnZXMpKSB7XG4gICAgICAgICAgICBpbWFnZXMuZm9yRWFjaCgoaW1hZ2VVcmw6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHVzZXJNZXNzYWdlQ29udGVudC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZV91cmxcIixcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGltYWdlVXJsLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICAgICAgbW9kZWw6IFwiZ3B0LTRvXCIsXG4gICAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogdXNlck1lc3NhZ2VDb250ZW50LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9LFxuICAgICAgICAgICAgdGVtcGVyYXR1cmU6IDAuMyxcbiAgICAgICAgICAgIG1heF90b2tlbnM6IDE1MDAsXG4gICAgICAgIH0pXG5cbiAgICAgICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50XG4gICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gY29udGVudCBnZW5lcmF0ZWRcIilcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJhd0VzdGltYXRlID0gSlNPTi5wYXJzZShjb250ZW50KSBhcyBhbnlcblxuICAgICAgICBjb25zdCBub3JtYWxpemVkSXRlbXMgPSAoQXJyYXkuaXNBcnJheShyYXdFc3RpbWF0ZT8uaXRlbXMpID8gcmF3RXN0aW1hdGUuaXRlbXMgOiBbXSlcbiAgICAgICAgICAgIC5tYXAoKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikgPT4gbm9ybWFsaXplSXRlbShpdGVtLCBpbmRleCkpXG4gICAgICAgICAgICAuZmlsdGVyKChpdGVtOiBhbnkpID0+IGl0ZW0uZGVzY3JpcHRpb24gIT09IFwiXCIpXG5cbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZFNlY3Rpb25zID0gKEFycmF5LmlzQXJyYXkocmF3RXN0aW1hdGU/LnNlY3Rpb25zKSA/IHJhd0VzdGltYXRlLnNlY3Rpb25zIDogW10pXG4gICAgICAgICAgICAubWFwKChzZWN0aW9uOiBhbnksIHNlY3Rpb25JbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VjdGlvbkl0ZW1zID0gKEFycmF5LmlzQXJyYXkoc2VjdGlvbj8uaXRlbXMpID8gc2VjdGlvbi5pdGVtcyA6IFtdKVxuICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtOiBhbnksIGl0ZW1JbmRleDogbnVtYmVyKSA9PiBub3JtYWxpemVJdGVtKGl0ZW0sIGl0ZW1JbmRleCkpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGl0ZW06IGFueSkgPT4gaXRlbS5kZXNjcmlwdGlvbiAhPT0gXCJcIilcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOlxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHNlY3Rpb24/LmlkID09PSBcInN0cmluZ1wiICYmIHNlY3Rpb24uaWQudHJpbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBzZWN0aW9uLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBgc2VjdGlvbi0ke3NlY3Rpb25JbmRleCArIDF9YCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBzZWN0aW9uPy5uYW1lID09PSBcInN0cmluZ1wiICYmIHNlY3Rpb24ubmFtZS50cmltKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHNlY3Rpb24ubmFtZS50cmltKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGBTZWN0aW9uICR7c2VjdGlvbkluZGV4ICsgMX1gLFxuICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbkNvZGU6XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygc2VjdGlvbj8uZGl2aXNpb25Db2RlID09PSBcInN0cmluZ1wiICYmIHNlY3Rpb24uZGl2aXNpb25Db2RlLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gc2VjdGlvbi5kaXZpc2lvbkNvZGUudHJpbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBzZWN0aW9uSXRlbXMsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHNlY3Rpb246IGFueSkgPT4gc2VjdGlvbi5pdGVtcy5sZW5ndGggPiAwKVxuXG4gICAgICAgIGNvbnN0IHdhcm5pbmdzID0gQXJyYXkuaXNBcnJheShyYXdFc3RpbWF0ZT8ud2FybmluZ3MpXG4gICAgICAgICAgICA/IHJhd0VzdGltYXRlLndhcm5pbmdzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigod2FybmluZzogYW55KSA9PiB0eXBlb2Ygd2FybmluZyA9PT0gXCJzdHJpbmdcIiAmJiB3YXJuaW5nLnRyaW0oKSlcbiAgICAgICAgICAgICAgICAubWFwKCh3YXJuaW5nOiBzdHJpbmcpID0+IHdhcm5pbmcudHJpbSgpKVxuICAgICAgICAgICAgOiBbXVxuXG4gICAgICAgIGNvbnN0IGVzdGltYXRlID0ge1xuICAgICAgICAgICAgaXRlbXM6IG5vcm1hbGl6ZWRJdGVtcyxcbiAgICAgICAgICAgIC4uLihub3JtYWxpemVkU2VjdGlvbnMubGVuZ3RoID4gMCA/IHsgc2VjdGlvbnM6IG5vcm1hbGl6ZWRTZWN0aW9ucyB9IDoge30pLFxuICAgICAgICAgICAgc3VtbWFyeV9ub3RlOiB0eXBlb2YgcmF3RXN0aW1hdGU/LnN1bW1hcnlfbm90ZSA9PT0gXCJzdHJpbmdcIiA/IHJhd0VzdGltYXRlLnN1bW1hcnlfbm90ZSA6IFwiXCIsXG4gICAgICAgICAgICBwYXltZW50X3Rlcm1zOiB0eXBlb2YgcmF3RXN0aW1hdGU/LnBheW1lbnRfdGVybXMgPT09IFwic3RyaW5nXCIgPyByYXdFc3RpbWF0ZS5wYXltZW50X3Rlcm1zIDogXCJcIixcbiAgICAgICAgICAgIGNsb3Npbmdfbm90ZTogdHlwZW9mIHJhd0VzdGltYXRlPy5jbG9zaW5nX25vdGUgPT09IFwic3RyaW5nXCIgPyByYXdFc3RpbWF0ZS5jbG9zaW5nX25vdGUgOiBcIlwiLFxuICAgICAgICAgICAgd2FybmluZ3MsXG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCByZWNvcmRVc2FnZShxdW90YS5jb250ZXh0LCBcImdlbmVyYXRlXCIsIHtcbiAgICAgICAgICAgIHByb21wdFRva2VuczogcmVzcG9uc2UudXNhZ2U/LnByb21wdF90b2tlbnMgfHwgMCxcbiAgICAgICAgICAgIGNvbXBsZXRpb25Ub2tlbnM6IHJlc3BvbnNlLnVzYWdlPy5jb21wbGV0aW9uX3Rva2VucyB8fCAwLFxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihlc3RpbWF0ZSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyBlc3RpbWF0ZTpcIiwgZXJyb3IpXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGVzdGltYXRlXCIgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgICApXG4gICAgfVxufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsIk5leHRSZXNwb25zZSIsImNoZWNrUmF0ZUxpbWl0IiwiZ2V0Q2xpZW50SXAiLCJlbmZvcmNlVXNhZ2VRdW90YSIsInJlY29yZFVzYWdlIiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwidG9GaW5pdGVOdW1iZXIiLCJ2YWx1ZSIsImZhbGxiYWNrIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJwYXJzZWQiLCJub3JtYWxpemVJdGVtIiwiaXRlbSIsImluZGV4IiwicXVhbnRpdHkiLCJ1bml0UHJpY2UiLCJ1bml0X3ByaWNlIiwidG90YWwiLCJpZCIsInRyaW0iLCJpdGVtTnVtYmVyIiwiTWF0aCIsIm1heCIsImZsb29yIiwiY2F0ZWdvcnkiLCJkZXNjcmlwdGlvbiIsInVuaXQiLCJnZXRTeXN0ZW1Qcm9tcHRWNSIsInVzZXJQcm9maWxlIiwicHJvamVjdFR5cGUiLCJjaXR5IiwiY291bnRyeSIsInRheFJhdGUiLCJidXNpbmVzc05hbWUiLCJjdXJyZW5jeUNvZGUiLCJwcmljZUxpc3QiLCJwcmljZUxpc3RTZWN0aW9uIiwicHJvamVjdENvbnRleHQiLCJQT1NUIiwicmVxIiwicXVvdGEiLCJyZXF1aXJlQXV0aCIsIm9rIiwianNvbiIsImVycm9yIiwiY29kZSIsIm1ldHJpYyIsInVzYWdlIiwidXNlZCIsImxpbWl0Iiwic3RhdHVzIiwiaW1hZ2VzIiwibm90ZXMiLCJpcCIsInJhdGVMaW1pdCIsImtleSIsIndpbmRvd01zIiwiYWxsb3dlZCIsImxlbmd0aCIsInVuZGVmaW5lZCIsIkFycmF5IiwiaXNBcnJheSIsImhhc0ludmFsaWRJbWFnZSIsInNvbWUiLCJpbWFnZSIsInByb2ZpbGUiLCJzeXN0ZW1Qcm9tcHQiLCJ1c2VyTWVzc2FnZUNvbnRlbnQiLCJwdXNoIiwidHlwZSIsInRleHQiLCJmb3JFYWNoIiwiaW1hZ2VVcmwiLCJpbWFnZV91cmwiLCJ1cmwiLCJyZXNwb25zZSIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInJlc3BvbnNlX2Zvcm1hdCIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsImNob2ljZXMiLCJtZXNzYWdlIiwiRXJyb3IiLCJyYXdFc3RpbWF0ZSIsIkpTT04iLCJwYXJzZSIsIm5vcm1hbGl6ZWRJdGVtcyIsIml0ZW1zIiwibWFwIiwiZmlsdGVyIiwibm9ybWFsaXplZFNlY3Rpb25zIiwic2VjdGlvbnMiLCJzZWN0aW9uIiwic2VjdGlvbkluZGV4Iiwic2VjdGlvbkl0ZW1zIiwiaXRlbUluZGV4IiwibmFtZSIsImRpdmlzaW9uQ29kZSIsIndhcm5pbmdzIiwid2FybmluZyIsImVzdGltYXRlIiwic3VtbWFyeV9ub3RlIiwicGF5bWVudF90ZXJtcyIsImNsb3Npbmdfbm90ZSIsImNvbnRleHQiLCJwcm9tcHRUb2tlbnMiLCJwcm9tcHRfdG9rZW5zIiwiY29tcGxldGlvblRva2VucyIsImNvbXBsZXRpb25fdG9rZW5zIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/rate-limit.ts":
/*!***************************!*\
  !*** ./lib/rate-limit.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkRateLimit: () => (/* binding */ checkRateLimit),\n/* harmony export */   getClientIp: () => (/* binding */ getClientIp)\n/* harmony export */ });\nconst buckets = new Map();\nlet hasLoggedProviderFallback = false;\nlet hasLoggedMissingUpstashConfig = false;\nfunction normalizeProvider(value) {\n    if (!value) return null;\n    const normalized = value.trim().toLowerCase();\n    if (normalized === \"memory\") return \"memory\";\n    if (normalized === \"upstash\") return \"upstash\";\n    return null;\n}\nfunction hasUpstashConfig() {\n    return Boolean(process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN);\n}\nfunction resolveProvider() {\n    const explicit = normalizeProvider(process.env.RATE_LIMIT_PROVIDER);\n    if (explicit === \"memory\") return \"memory\";\n    if (explicit === \"upstash\") {\n        if (hasUpstashConfig()) return \"upstash\";\n        if (!hasLoggedMissingUpstashConfig) {\n            hasLoggedMissingUpstashConfig = true;\n            console.warn(\"RATE_LIMIT_PROVIDER=upstash but Upstash env vars are missing. Falling back to memory limiter.\");\n        }\n        return \"memory\";\n    }\n    return hasUpstashConfig() ? \"upstash\" : \"memory\";\n}\nfunction getClientIp(req) {\n    const forwardedFor = req.headers.get(\"x-forwarded-for\");\n    if (forwardedFor) {\n        return forwardedFor.split(\",\")[0].trim();\n    }\n    const realIp = req.headers.get(\"x-real-ip\");\n    return realIp?.trim() || \"unknown\";\n}\nfunction getMemoryRateLimit(options) {\n    const now = Date.now();\n    const existing = buckets.get(options.key);\n    if (!existing || existing.resetAt <= now) {\n        buckets.set(options.key, {\n            count: 1,\n            resetAt: now + options.windowMs\n        });\n        return {\n            allowed: true,\n            remaining: options.limit - 1,\n            resetAt: now + options.windowMs\n        };\n    }\n    if (existing.count >= options.limit) {\n        return {\n            allowed: false,\n            remaining: 0,\n            resetAt: existing.resetAt\n        };\n    }\n    existing.count += 1;\n    buckets.set(options.key, existing);\n    return {\n        allowed: true,\n        remaining: Math.max(0, options.limit - existing.count),\n        resetAt: existing.resetAt\n    };\n}\nfunction sanitizeKey(key) {\n    return key.replace(/[^a-zA-Z0-9:_-]/g, \"_\").slice(0, 180);\n}\nasync function callUpstash(command) {\n    const baseUrl = process.env.UPSTASH_REDIS_REST_URL;\n    const token = process.env.UPSTASH_REDIS_REST_TOKEN;\n    if (!baseUrl || !token) {\n        throw new Error(\"Upstash config missing\");\n    }\n    const commandPath = command.map((part)=>encodeURIComponent(String(part))).join(\"/\");\n    const response = await fetch(`${baseUrl}/${commandPath}`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${token}`\n        },\n        cache: \"no-store\"\n    });\n    if (!response.ok) {\n        throw new Error(`Upstash request failed: ${response.status}`);\n    }\n    const payload = await response.json();\n    if (payload.error) {\n        throw new Error(`Upstash error: ${payload.error}`);\n    }\n    return payload.result;\n}\nasync function getUpstashRateLimit(options) {\n    const now = Date.now();\n    const redisKey = `rl:${sanitizeKey(options.key)}`;\n    const incrementResult = await callUpstash([\n        \"INCR\",\n        redisKey\n    ]);\n    const count = Number(incrementResult || 0);\n    if (!Number.isFinite(count) || count <= 0) {\n        throw new Error(\"Invalid Upstash INCR response\");\n    }\n    if (count === 1) {\n        await callUpstash([\n            \"PEXPIRE\",\n            redisKey,\n            options.windowMs\n        ]);\n    }\n    const ttlResult = await callUpstash([\n        \"PTTL\",\n        redisKey\n    ]);\n    const ttlMs = Number(ttlResult || 0);\n    const effectiveTtl = ttlMs > 0 ? ttlMs : options.windowMs;\n    return {\n        allowed: count <= options.limit,\n        remaining: count <= options.limit ? Math.max(0, options.limit - count) : 0,\n        resetAt: now + effectiveTtl\n    };\n}\nasync function checkRateLimit(options) {\n    const provider = resolveProvider();\n    if (provider === \"memory\") {\n        return getMemoryRateLimit(options);\n    }\n    try {\n        return await getUpstashRateLimit(options);\n    } catch (error) {\n        if (!hasLoggedProviderFallback) {\n            hasLoggedProviderFallback = true;\n            console.error(\"Upstash rate limiter unavailable. Falling back to in-memory limiter.\", error);\n        }\n        return getMemoryRateLimit(options);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTUCxRQUFRVyxLQUFLO1FBQy9CRCxXQUFXSCxTQUFTUCxRQUFRVyxLQUFLLEdBQUdDLEtBQUtDLEdBQUcsQ0FBQyxHQUFHYixRQUFRVyxLQUFLLEdBQUdKLFNBQVM7UUFDekVGLFNBQVNKLE1BQU02QztJQUNuQjtBQUNKO0FBRU8sZUFBZUMsZUFBZS9DLE9BQXlCO0lBQzFELE1BQU1nRCxXQUFXN0Q7SUFDakIsSUFBSTZELGFBQWEsVUFBVTtRQUN2QixPQUFPakQsbUJBQW1CQztJQUM5QjtJQUVBLElBQUk7UUFDQSxPQUFPLE1BQU11QyxvQkFBb0J2QztJQUNyQyxFQUFFLE9BQU9xQyxPQUFPO1FBQ1osSUFBSSxDQUFDL0QsMkJBQTJCO1lBQzVCQSw0QkFBNEI7WUFDNUJnQixRQUFRK0MsS0FBSyxDQUFDLHdFQUF3RUE7UUFDMUY7UUFDQSxPQUFPdEMsbUJBQW1CQztJQUM5QjtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc25hcHF1b3RlLy4vbGliL3JhdGUtbGltaXQudHM/MjJjOCJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIEJ1Y2tldCA9IHtcbiAgICBjb3VudDogbnVtYmVyXG4gICAgcmVzZXRBdDogbnVtYmVyXG59XG5cbmNvbnN0IGJ1Y2tldHMgPSBuZXcgTWFwPHN0cmluZywgQnVja2V0PigpXG5sZXQgaGFzTG9nZ2VkUHJvdmlkZXJGYWxsYmFjayA9IGZhbHNlXG5sZXQgaGFzTG9nZ2VkTWlzc2luZ1Vwc3Rhc2hDb25maWcgPSBmYWxzZVxuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0T3B0aW9ucyB7XG4gICAga2V5OiBzdHJpbmdcbiAgICBsaW1pdDogbnVtYmVyXG4gICAgd2luZG93TXM6IG51bWJlclxufVxuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0UmVzdWx0IHtcbiAgICBhbGxvd2VkOiBib29sZWFuXG4gICAgcmVtYWluaW5nOiBudW1iZXJcbiAgICByZXNldEF0OiBudW1iZXJcbn1cblxudHlwZSBSYXRlTGltaXRQcm92aWRlciA9IFwibWVtb3J5XCIgfCBcInVwc3Rhc2hcIlxuXG5mdW5jdGlvbiBub3JtYWxpemVQcm92aWRlcih2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkKTogUmF0ZUxpbWl0UHJvdmlkZXIgfCBudWxsIHtcbiAgICBpZiAoIXZhbHVlKSByZXR1cm4gbnVsbFxuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB2YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKVxuICAgIGlmIChub3JtYWxpemVkID09PSBcIm1lbW9yeVwiKSByZXR1cm4gXCJtZW1vcnlcIlxuICAgIGlmIChub3JtYWxpemVkID09PSBcInVwc3Rhc2hcIikgcmV0dXJuIFwidXBzdGFzaFwiXG4gICAgcmV0dXJuIG51bGxcbn1cblxuZnVuY3Rpb24gaGFzVXBzdGFzaENvbmZpZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVVJMICYmIHByb2Nlc3MuZW52LlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTilcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVByb3ZpZGVyKCk6IFJhdGVMaW1pdFByb3ZpZGVyIHtcbiAgICBjb25zdCBleHBsaWNpdCA9IG5vcm1hbGl6ZVByb3ZpZGVyKHByb2Nlc3MuZW52LlJBVEVfTElNSVRfUFJPVklERVIpXG4gICAgaWYgKGV4cGxpY2l0ID09PSBcIm1lbW9yeVwiKSByZXR1cm4gXCJtZW1vcnlcIlxuICAgIGlmIChleHBsaWNpdCA9PT0gXCJ1cHN0YXNoXCIpIHtcbiAgICAgICAgaWYgKGhhc1Vwc3Rhc2hDb25maWcoKSkgcmV0dXJuIFwidXBzdGFzaFwiXG4gICAgICAgIGlmICghaGFzTG9nZ2VkTWlzc2luZ1Vwc3Rhc2hDb25maWcpIHtcbiAgICAgICAgICAgIGhhc0xvZ2dlZE1pc3NpbmdVcHN0YXNoQ29uZmlnID0gdHJ1ZVxuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiUkFURV9MSU1JVF9QUk9WSURFUj11cHN0YXNoIGJ1dCBVcHN0YXNoIGVudiB2YXJzIGFyZSBtaXNzaW5nLiBGYWxsaW5nIGJhY2sgdG8gbWVtb3J5IGxpbWl0ZXIuXCIpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwibWVtb3J5XCJcbiAgICB9XG5cbiAgICByZXR1cm4gaGFzVXBzdGFzaENvbmZpZygpID8gXCJ1cHN0YXNoXCIgOiBcIm1lbW9yeVwiXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDbGllbnRJcChyZXE6IFJlcXVlc3QpOiBzdHJpbmcge1xuICAgIGNvbnN0IGZvcndhcmRlZEZvciA9IHJlcS5oZWFkZXJzLmdldChcIngtZm9yd2FyZGVkLWZvclwiKVxuICAgIGlmIChmb3J3YXJkZWRGb3IpIHtcbiAgICAgICAgcmV0dXJuIGZvcndhcmRlZEZvci5zcGxpdChcIixcIilbMF0udHJpbSgpXG4gICAgfVxuXG4gICAgY29uc3QgcmVhbElwID0gcmVxLmhlYWRlcnMuZ2V0KFwieC1yZWFsLWlwXCIpXG4gICAgcmV0dXJuIHJlYWxJcD8udHJpbSgpIHx8IFwidW5rbm93blwiXG59XG5cbmZ1bmN0aW9uIGdldE1lbW9yeVJhdGVMaW1pdChvcHRpb25zOiBSYXRlTGltaXRPcHRpb25zKTogUmF0ZUxpbWl0UmVzdWx0IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgY29uc3QgZXhpc3RpbmcgPSBidWNrZXRzLmdldChvcHRpb25zLmtleSlcblxuICAgIGlmICghZXhpc3RpbmcgfHwgZXhpc3RpbmcucmVzZXRBdCA8PSBub3cpIHtcbiAgICAgICAgYnVja2V0cy5zZXQob3B0aW9ucy5rZXksIHsgY291bnQ6IDEsIHJlc2V0QXQ6IG5vdyArIG9wdGlvbnMud2luZG93TXMgfSlcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICAgICAgICByZW1haW5pbmc6IG9wdGlvbnMubGltaXQgLSAxLFxuICAgICAgICAgICAgcmVzZXRBdDogbm93ICsgb3B0aW9ucy53aW5kb3dNcyxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChleGlzdGluZy5jb3VudCA+PSBvcHRpb25zLmxpbWl0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbWFpbmluZzogMCxcbiAgICAgICAgICAgIHJlc2V0QXQ6IGV4aXN0aW5nLnJlc2V0QXQsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleGlzdGluZy5jb3VudCArPSAxXG4gICAgYnVja2V0cy5zZXQob3B0aW9ucy5rZXksIGV4aXN0aW5nKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgICAgcmVtYWluaW5nOiBNYXRoLm1heCgwLCBvcHRpb25zLmxpbWl0IC0gZXhpc3RpbmcuY291bnQpLFxuICAgICAgICByZXNldEF0OiBleGlzdGluZy5yZXNldEF0LFxuICAgIH1cbn1cblxuZnVuY3Rpb24gc2FuaXRpemVLZXkoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBrZXkucmVwbGFjZSgvW15hLXpBLVowLTk6Xy1dL2csIFwiX1wiKS5zbGljZSgwLCAxODApXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbGxVcHN0YXNoKGNvbW1hbmQ6IEFycmF5PHN0cmluZyB8IG51bWJlcj4pOiBQcm9taXNlPHVua25vd24+IHtcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1VSTFxuICAgIGNvbnN0IHRva2VuID0gcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOXG4gICAgaWYgKCFiYXNlVXJsIHx8ICF0b2tlbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVcHN0YXNoIGNvbmZpZyBtaXNzaW5nXCIpXG4gICAgfVxuXG4gICAgY29uc3QgY29tbWFuZFBhdGggPSBjb21tYW5kLm1hcCgocGFydCkgPT4gZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhwYXJ0KSkpLmpvaW4oXCIvXCIpXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtiYXNlVXJsfS8ke2NvbW1hbmRQYXRofWAsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXG4gICAgICAgIH0sXG4gICAgICAgIGNhY2hlOiBcIm5vLXN0b3JlXCIsXG4gICAgfSlcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVcHN0YXNoIHJlcXVlc3QgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c31gKVxuICAgIH1cblxuICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkgYXMgeyByZXN1bHQ/OiB1bmtub3duOyBlcnJvcj86IHN0cmluZyB9XG4gICAgaWYgKHBheWxvYWQuZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVcHN0YXNoIGVycm9yOiAke3BheWxvYWQuZXJyb3J9YClcbiAgICB9XG5cbiAgICByZXR1cm4gcGF5bG9hZC5yZXN1bHRcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VXBzdGFzaFJhdGVMaW1pdChvcHRpb25zOiBSYXRlTGltaXRPcHRpb25zKTogUHJvbWlzZTxSYXRlTGltaXRSZXN1bHQ+IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgY29uc3QgcmVkaXNLZXkgPSBgcmw6JHtzYW5pdGl6ZUtleShvcHRpb25zLmtleSl9YFxuXG4gICAgY29uc3QgaW5jcmVtZW50UmVzdWx0ID0gYXdhaXQgY2FsbFVwc3Rhc2goW1wiSU5DUlwiLCByZWRpc0tleV0pXG4gICAgY29uc3QgY291bnQgPSBOdW1iZXIoaW5jcmVtZW50UmVzdWx0IHx8IDApXG5cbiAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShjb3VudCkgfHwgY291bnQgPD0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIFVwc3Rhc2ggSU5DUiByZXNwb25zZVwiKVxuICAgIH1cblxuICAgIGlmIChjb3VudCA9PT0gMSkge1xuICAgICAgICBhd2FpdCBjYWxsVXBzdGFzaChbXCJQRVhQSVJFXCIsIHJlZGlzS2V5LCBvcHRpb25zLndpbmRvd01zXSlcbiAgICB9XG5cbiAgICBjb25zdCB0dGxSZXN1bHQgPSBhd2FpdCBjYWxsVXBzdGFzaChbXCJQVFRMXCIsIHJlZGlzS2V5XSlcbiAgICBjb25zdCB0dGxNcyA9IE51bWJlcih0dGxSZXN1bHQgfHwgMClcbiAgICBjb25zdCBlZmZlY3RpdmVUdGwgPSB0dGxNcyA+IDAgPyB0dGxNcyA6IG9wdGlvbnMud2luZG93TXNcblxuICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGNvdW50IDw9IG9wdGlvbnMubGltaXQsXG4gICAgICAgIHJlbWFpbmluZzogY291bnQgPD0gb3B0aW9ucy5saW1pdCA/IE1hdGgubWF4KDAsIG9wdGlvbnMubGltaXQgLSBjb3VudCkgOiAwLFxuICAgICAgICByZXNldEF0OiBub3cgKyBlZmZlY3RpdmVUdGwsXG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tSYXRlTGltaXQob3B0aW9uczogUmF0ZUxpbWl0T3B0aW9ucyk6IFByb21pc2U8UmF0ZUxpbWl0UmVzdWx0PiB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSByZXNvbHZlUHJvdmlkZXIoKVxuICAgIGlmIChwcm92aWRlciA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICByZXR1cm4gZ2V0TWVtb3J5UmF0ZUxpbWl0KG9wdGlvbnMpXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldFVwc3Rhc2hSYXRlTGltaXQob3B0aW9ucylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoIWhhc0xvZ2dlZFByb3ZpZGVyRmFsbGJhY2spIHtcbiAgICAgICAgICAgIGhhc0xvZ2dlZFByb3ZpZGVyRmFsbGJhY2sgPSB0cnVlXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBzdGFzaCByYXRlIGxpbWl0ZXIgdW5hdmFpbGFibGUuIEZhbGxpbmcgYmFjayB0byBpbi1tZW1vcnkgbGltaXRlci5cIiwgZXJyb3IpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldE1lbW9yeVJhdGVMaW1pdChvcHRpb25zKVxuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJidWNrZXRzIiwiTWFwIiwiaGFzTG9nZ2VkUHJvdmlkZXJGYWxsYmFjayIsImhhc0xvZ2dlZE1pc3NpbmdVcHN0YXNoQ29uZmlnIiwibm9ybWFsaXplUHJvdmlkZXIiLCJ2YWx1ZSIsIm5vcm1hbGl6ZWQiLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJoYXNVcHN0YXNoQ29uZmlnIiwiQm9vbGVhbiIsInByb2Nlc3MiLCJlbnYiLCJVUFNUQVNIX1JFRElTX1JFU1RfVVJMIiwiVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOIiwicmVzb2x2ZVByb3ZpZGVyIiwiZXhwbGljaXQiLCJSQVRFX0xJTUlUX1BST1ZJREVSIiwiY29uc29sZSIsIndhcm4iLCJnZXRDbGllbnRJcCIsInJlcSIsImZvcndhcmRlZEZvciIsImhlYWRlcnMiLCJnZXQiLCJzcGxpdCIsInJlYWxJcCIsImdldE1lbW9yeVJhdGVMaW1pdCIsIm9wdGlvbnMiLCJub3ciLCJEYXRlIiwiZXhpc3RpbmciLCJrZXkiLCJyZXNldEF0Iiwic2V0IiwiY291bnQiLCJ3aW5kb3dNcyIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJsaW1pdCIsIk1hdGgiLCJtYXgiLCJzYW5pdGl6ZUtleSIsInJlcGxhY2UiLCJzbGljZSIsImNhbGxVcHN0YXNoIiwiY29tbWFuZCIsImJhc2VVcmwiLCJ0b2tlbiIsIkVycm9yIiwiY29tbWFuZFBhdGgiLCJtYXAiLCJwYXJ0IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiU3RyaW5nIiwiam9pbiIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJBdXRob3JpemF0aW9uIiwiY2FjaGUiLCJvayIsInN0YXR1cyIsInBheWxvYWQiLCJqc29uIiwiZXJyb3IiLCJyZXN1bHQiLCJnZXRVcHN0YXNoUmF0ZUxpbWl0IiwicmVkaXNLZXkiLCJpbmNyZW1lbnRSZXN1bHQiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsInR0bFJlc3VsdCIsInR0bE1zIiwiZWZmZWN0aXZlVHRsIiwiY2hlY2tSYXRlTGltaXQiLCJwcm92aWRlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/rate-limit.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/supabase-auth.ts":
/*!*************************************!*\
  !*** ./lib/server/supabase-auth.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAuthedSupabaseClient: () => (/* binding */ createAuthedSupabaseClient),\n/* harmony export */   parseBearerToken: () => (/* binding */ parseBearerToken)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/esm/wrapper.mjs\");\n\nfunction parseBearerToken(req) {\n    const authHeader = req.headers.get(\"authorization\") || \"\";\n    if (!authHeader.toLowerCase().startsWith(\"bearer \")) return \"\";\n    return authHeader.slice(7).trim();\n}\nfunction createAuthedSupabaseClient(accessToken) {\n    if (false) {}\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://fhjhyrwoigtuvvocpcjv.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhem1oa3VqZ3R6cWxiY2dxc3l5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNTk2NTcsImV4cCI6MjA4MDkzNTY1N30.Ly3_k9tveLX85L5y9zezQCsfNyu23BZWar9bszn5qyA\", {\n        global: {\n            headers: {\n                Authorization: `Bearer ${accessToken}`\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2VydmVyL3N1cGFiYXNlLWF1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW9EO0FBRTdDLFNBQVNDLGlCQUFpQkMsR0FBWTtJQUN6QyxNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxvQkFBb0I7SUFDdkQsSUFBSSxDQUFDRixXQUFXRyxXQUFXLEdBQUdDLFVBQVUsQ0FBQyxZQUFZLE9BQU87SUFDNUQsT0FBT0osV0FBV0ssS0FBSyxDQUFDLEdBQUdDLElBQUk7QUFDbkM7QUFFTyxTQUFTQywyQkFBMkJDLFdBQW1CO0lBQzFELElBQUksS0FBbUYsRUFBRSxFQUV4RjtJQUVELE9BQU9YLG1FQUFZQSxDQUNmWSwwQ0FBb0MsRUFDcENBLGtOQUF5QyxFQUN6QztRQUNJSSxRQUFRO1lBQ0paLFNBQVM7Z0JBQ0xhLGVBQWUsQ0FBQyxPQUFPLEVBQUVOLFlBQVksQ0FBQztZQUMxQztRQUNKO0lBQ0o7QUFFUiIsInNvdXJjZXMiOlsid2VicGFjazovL3NuYXBxdW90ZS8uL2xpYi9zZXJ2ZXIvc3VwYWJhc2UtYXV0aC50cz9hMjQ1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIlxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VCZWFyZXJUb2tlbihyZXE6IFJlcXVlc3QpOiBzdHJpbmcge1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoXCJhdXRob3JpemF0aW9uXCIpIHx8IFwiXCJcbiAgICBpZiAoIWF1dGhIZWFkZXIudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKFwiYmVhcmVyIFwiKSkgcmV0dXJuIFwiXCJcbiAgICByZXR1cm4gYXV0aEhlYWRlci5zbGljZSg3KS50cmltKClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUF1dGhlZFN1cGFiYXNlQ2xpZW50KGFjY2Vzc1Rva2VuOiBzdHJpbmcpIHtcbiAgICBpZiAoIXByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAhcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICByZXR1cm4gY3JlYXRlQ2xpZW50KFxuICAgICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXG4gICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZLFxuICAgICAgICB7XG4gICAgICAgICAgICBnbG9iYWw6IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgKVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInBhcnNlQmVhcmVyVG9rZW4iLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInRvTG93ZXJDYXNlIiwic3RhcnRzV2l0aCIsInNsaWNlIiwidHJpbSIsImNyZWF0ZUF1dGhlZFN1cGFiYXNlQ2xpZW50IiwiYWNjZXNzVG9rZW4iLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJnbG9iYWwiLCJBdXRob3JpemF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/supabase-auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/usage-quota.ts":
/*!***********************************!*\
  !*** ./lib/server/usage-quota.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceUsageQuota: () => (/* binding */ enforceUsageQuota),\n/* harmony export */   getUsageSnapshot: () => (/* binding */ getUsageSnapshot),\n/* harmony export */   recordUsage: () => (/* binding */ recordUsage)\n/* harmony export */ });\n/* harmony import */ var _lib_server_supabase_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/server/supabase-auth */ \"(rsc)/./lib/server/supabase-auth.ts\");\n\nconst PLAN_LIMITS = {\n    free: {\n        generate: 50,\n        transcribe: 80,\n        send_email: 40\n    },\n    pro: {\n        generate: 2000,\n        transcribe: 4000,\n        send_email: 1500\n    }\n};\nconst OPENAI_INPUT_COST_PER_TOKEN = 5 / 1000000;\nconst OPENAI_OUTPUT_COST_PER_TOKEN = 15 / 1000000;\nconst DEFAULT_RESEND_COST_USD = 0.001;\nfunction toPlanTier(value) {\n    return value === \"pro\" ? \"pro\" : \"free\";\n}\nfunction toNumber(value) {\n    if (typeof value === \"number\" && Number.isFinite(value)) return value;\n    if (typeof value === \"string\") {\n        const parsed = Number(value);\n        if (Number.isFinite(parsed)) return parsed;\n    }\n    return 0;\n}\nfunction getMonthPeriodStart(date = new Date()) {\n    const utc = new Date(Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), 1));\n    return utc.toISOString().slice(0, 10);\n}\nfunction metricCount(row, metric) {\n    if (metric === \"generate\") return toNumber(row.generate_count);\n    if (metric === \"transcribe\") return toNumber(row.transcribe_count);\n    return toNumber(row.send_email_count);\n}\nasync function ensureProfileRow(supabase, userId) {\n    try {\n        await supabase.from(\"profiles\").upsert({\n            id: userId\n        }, {\n            onConflict: \"id\",\n            ignoreDuplicates: true\n        });\n    } catch  {\n    // Profile creation should not block runtime usage checks.\n    }\n}\nasync function loadPlanTier(supabase, userId) {\n    const { data, error } = await supabase.from(\"profiles\").select(\"plan_tier\").eq(\"id\", userId).maybeSingle();\n    if (error) {\n        return \"free\";\n    }\n    return toPlanTier(data?.plan_tier);\n}\nasync function getOrCreateUsageRow(supabase, userId, periodStart, planTier) {\n    const { data: existing, error: existingError } = await supabase.from(\"usage_counters_monthly\").select(\"*\").eq(\"user_id\", userId).eq(\"period_start\", periodStart).maybeSingle();\n    if (existingError) throw existingError;\n    if (existing) {\n        return {\n            ...existing,\n            plan_tier: toPlanTier(existing.plan_tier)\n        };\n    }\n    const { data: inserted, error: insertError } = await supabase.from(\"usage_counters_monthly\").insert({\n        user_id: userId,\n        period_start: periodStart,\n        plan_tier: planTier\n    }).select(\"*\").single();\n    if (insertError || !inserted) throw insertError || new Error(\"Failed to initialize usage row\");\n    return {\n        ...inserted,\n        plan_tier: toPlanTier(inserted.plan_tier)\n    };\n}\nasync function emitQuotaMilestoneEvent(context, metric, milestone, used, limit) {\n    const eventName = milestone === \"warning\" ? \"free_quota_warning\" : \"free_quota_limit_hit\";\n    const externalId = `quota:${context.userId}:${context.periodStart}:${metric}:${milestone}`;\n    try {\n        await context.supabase.from(\"analytics_events\").upsert({\n            user_id: context.userId,\n            event_name: eventName,\n            channel: \"paywall\",\n            external_id: externalId,\n            metadata: {\n                metric,\n                used,\n                limit,\n                periodStart: context.periodStart,\n                planTier: context.planTier\n            }\n        }, {\n            onConflict: \"external_id\",\n            ignoreDuplicates: true\n        });\n    } catch  {\n    // Analytics insert should never break core flows.\n    }\n}\nasync function resolveUsageContext(req, options = {}) {\n    const token = (0,_lib_server_supabase_auth__WEBPACK_IMPORTED_MODULE_0__.parseBearerToken)(req);\n    if (!token) {\n        if (options.requireAuth) {\n            return {\n                context: null,\n                status: 401,\n                error: \"Unauthorized\"\n            };\n        }\n        return {\n            context: null\n        };\n    }\n    const supabase = (0,_lib_server_supabase_auth__WEBPACK_IMPORTED_MODULE_0__.createAuthedSupabaseClient)(token);\n    if (!supabase) {\n        if (options.requireAuth) {\n            return {\n                context: null,\n                status: 500,\n                error: \"Supabase is not configured\"\n            };\n        }\n        return {\n            context: null\n        };\n    }\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\n    if (userError || !user) {\n        if (options.requireAuth) {\n            return {\n                context: null,\n                status: 401,\n                error: \"Unauthorized\"\n            };\n        }\n        return {\n            context: null\n        };\n    }\n    const userId = user.id;\n    const periodStart = getMonthPeriodStart();\n    try {\n        await ensureProfileRow(supabase, userId);\n        const planTier = await loadPlanTier(supabase, userId);\n        const row = await getOrCreateUsageRow(supabase, userId, periodStart, planTier);\n        return {\n            context: {\n                supabase,\n                userId,\n                planTier,\n                periodStart,\n                row\n            }\n        };\n    } catch (error) {\n        console.error(\"Usage context resolution failed:\", error);\n        if (options.requireAuth) {\n            return {\n                context: null,\n                status: 500,\n                error: \"Failed to resolve usage context\"\n            };\n        }\n        return {\n            context: null\n        };\n    }\n}\nasync function enforceUsageQuota(req, metric, options = {}) {\n    const resolved = await resolveUsageContext(req, {\n        requireAuth: Boolean(options.requireAuth)\n    });\n    if (!resolved.context) {\n        if (resolved.error) {\n            return {\n                ok: false,\n                status: resolved.status || 401,\n                error: resolved.error,\n                context: null\n            };\n        }\n        // No auth token and auth not required: keep endpoint usable, but no per-user quota enforcement.\n        return {\n            ok: true,\n            context: null\n        };\n    }\n    const context = resolved.context;\n    const used = metricCount(context.row, metric);\n    const limit = PLAN_LIMITS[context.planTier][metric];\n    const remaining = Math.max(0, limit - used);\n    if (context.planTier === \"free\") {\n        if (limit > 0 && used >= limit) {\n            await emitQuotaMilestoneEvent(context, metric, \"limit\", used, limit);\n            return {\n                ok: false,\n                status: 402,\n                error: `Free plan monthly limit reached for ${metric}.`,\n                context,\n                used,\n                limit,\n                remaining,\n                planTier: context.planTier\n            };\n        }\n        if (limit > 0 && used >= Math.ceil(limit * 0.8)) {\n            await emitQuotaMilestoneEvent(context, metric, \"warning\", used, limit);\n        }\n    }\n    return {\n        ok: true,\n        context,\n        used,\n        limit,\n        remaining,\n        planTier: context.planTier\n    };\n}\nasync function recordUsage(context, metric, input = {}) {\n    if (!context) return;\n    const current = context.row;\n    const nextGenerateCount = toNumber(current.generate_count) + (metric === \"generate\" ? 1 : 0);\n    const nextTranscribeCount = toNumber(current.transcribe_count) + (metric === \"transcribe\" ? 1 : 0);\n    const nextSendEmailCount = toNumber(current.send_email_count) + (metric === \"send_email\" ? 1 : 0);\n    const promptTokens = Math.max(0, Math.floor(input.promptTokens || 0));\n    const completionTokens = Math.max(0, Math.floor(input.completionTokens || 0));\n    const openaiCostIncrement = promptTokens * OPENAI_INPUT_COST_PER_TOKEN + completionTokens * OPENAI_OUTPUT_COST_PER_TOKEN;\n    const resendCostIncrement = metric === \"send_email\" ? Math.max(0, Number.isFinite(input.resendCostUsd) ? Number(input.resendCostUsd) : DEFAULT_RESEND_COST_USD) : 0;\n    const nextRowUpdate = {\n        plan_tier: context.planTier,\n        generate_count: nextGenerateCount,\n        transcribe_count: nextTranscribeCount,\n        send_email_count: nextSendEmailCount,\n        openai_prompt_tokens: toNumber(current.openai_prompt_tokens) + promptTokens,\n        openai_completion_tokens: toNumber(current.openai_completion_tokens) + completionTokens,\n        openai_estimated_cost: Number((toNumber(current.openai_estimated_cost) + openaiCostIncrement).toFixed(6)),\n        resend_estimated_cost: Number((toNumber(current.resend_estimated_cost) + resendCostIncrement).toFixed(6)),\n        updated_at: new Date().toISOString()\n    };\n    const { data: updated, error: updateError } = await context.supabase.from(\"usage_counters_monthly\").update(nextRowUpdate).eq(\"id\", current.id).select(\"*\").single();\n    if (updateError || !updated) {\n        console.error(\"Failed to update usage counters:\", updateError);\n        return;\n    }\n    const normalizedUpdated = {\n        ...updated,\n        plan_tier: toPlanTier(updated.plan_tier)\n    };\n    context.row = normalizedUpdated;\n    if (context.planTier !== \"free\") return;\n    const updatedUsed = metricCount(normalizedUpdated, metric);\n    const limit = PLAN_LIMITS[context.planTier][metric];\n    if (limit > 0 && updatedUsed >= limit) {\n        await emitQuotaMilestoneEvent(context, metric, \"limit\", updatedUsed, limit);\n        return;\n    }\n    if (limit > 0 && updatedUsed >= Math.ceil(limit * 0.8)) {\n        await emitQuotaMilestoneEvent(context, metric, \"warning\", updatedUsed, limit);\n    }\n}\nasync function getUsageSnapshot(req) {\n    const resolved = await resolveUsageContext(req, {\n        requireAuth: true\n    });\n    if (!resolved.context) {\n        return {\n            ok: false,\n            status: resolved.status || 401,\n            error: resolved.error || \"Unauthorized\"\n        };\n    }\n    const { planTier, periodStart, row } = resolved.context;\n    const usage = {\n        generate: toNumber(row.generate_count),\n        transcribe: toNumber(row.transcribe_count),\n        send_email: toNumber(row.send_email_count)\n    };\n    const limits = PLAN_LIMITS[planTier];\n    const remaining = {\n        generate: Math.max(0, limits.generate - usage.generate),\n        transcribe: Math.max(0, limits.transcribe - usage.transcribe),\n        send_email: Math.max(0, limits.send_email - usage.send_email)\n    };\n    const usageRatePct = {\n        generate: limits.generate > 0 ? Number((usage.generate / limits.generate * 100).toFixed(1)) : 0,\n        transcribe: limits.transcribe > 0 ? Number((usage.transcribe / limits.transcribe * 100).toFixed(1)) : 0,\n        send_email: limits.send_email > 0 ? Number((usage.send_email / limits.send_email * 100).toFixed(1)) : 0\n    };\n    const estimatedOpenai = Number(toNumber(row.openai_estimated_cost).toFixed(4));\n    const estimatedResend = Number(toNumber(row.resend_estimated_cost).toFixed(4));\n    return {\n        ok: true,\n        data: {\n            planTier,\n            periodStart,\n            usage,\n            limits,\n            remaining,\n            usageRatePct,\n            openaiPromptTokens: toNumber(row.openai_prompt_tokens),\n            openaiCompletionTokens: toNumber(row.openai_completion_tokens),\n            estimatedCosts: {\n                openai: estimatedOpenai,\n                resend: estimatedResend,\n                total: Number((estimatedOpenai + estimatedResend).toFixed(4))\n            }\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPLENBQUM7SUFDM0UsTUFBTWEsa0JBQWtCeEcsT0FBT0QsU0FBU2MsSUFBSStFLHFCQUFxQixFQUFFRCxPQUFPLENBQUM7SUFFM0UsT0FBTztRQUNIckIsSUFBSTtRQUNKM0MsTUFBTTtZQUNGUTtZQUNBRDtZQUNBa0U7WUFDQUM7WUFDQTlCO1lBQ0ErQjtZQUNBRyxvQkFBb0IxRyxTQUFTYyxJQUFJMkUsb0JBQW9CO1lBQ3JEa0Isd0JBQXdCM0csU0FBU2MsSUFBSTRFLHdCQUF3QjtZQUM3RGtCLGdCQUFnQjtnQkFDWkMsUUFBUUw7Z0JBQ1JNLFFBQVFMO2dCQUNSTSxPQUFPOUcsT0FBTyxDQUFDdUcsa0JBQWtCQyxlQUFjLEVBQUdiLE9BQU8sQ0FBQztZQUM5RDtRQUNKO0lBQ0o7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL3NuYXBxdW90ZS8uL2xpYi9zZXJ2ZXIvdXNhZ2UtcXVvdGEudHM/YmY2MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiXG5pbXBvcnQgeyBjcmVhdGVBdXRoZWRTdXBhYmFzZUNsaWVudCwgcGFyc2VCZWFyZXJUb2tlbiB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvc3VwYWJhc2UtYXV0aFwiXG5cbmV4cG9ydCB0eXBlIFVzYWdlTWV0cmljID0gXCJnZW5lcmF0ZVwiIHwgXCJ0cmFuc2NyaWJlXCIgfCBcInNlbmRfZW1haWxcIlxudHlwZSBQbGFuVGllciA9IFwiZnJlZVwiIHwgXCJwcm9cIlxuXG50eXBlIFF1b3RhTWlsZXN0b25lID0gXCJ3YXJuaW5nXCIgfCBcImxpbWl0XCJcblxuaW50ZXJmYWNlIFVzYWdlQ291bnRlcnNSb3cge1xuICAgIGlkOiBzdHJpbmdcbiAgICB1c2VyX2lkOiBzdHJpbmdcbiAgICBwZXJpb2Rfc3RhcnQ6IHN0cmluZ1xuICAgIHBsYW5fdGllcjogUGxhblRpZXJcbiAgICBnZW5lcmF0ZV9jb3VudDogbnVtYmVyXG4gICAgdHJhbnNjcmliZV9jb3VudDogbnVtYmVyXG4gICAgc2VuZF9lbWFpbF9jb3VudDogbnVtYmVyXG4gICAgb3BlbmFpX3Byb21wdF90b2tlbnM6IG51bWJlclxuICAgIG9wZW5haV9jb21wbGV0aW9uX3Rva2VuczogbnVtYmVyXG4gICAgb3BlbmFpX2VzdGltYXRlZF9jb3N0OiBudW1iZXJcbiAgICByZXNlbmRfZXN0aW1hdGVkX2Nvc3Q6IG51bWJlclxuICAgIHVwZGF0ZWRfYXQ6IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgVXNhZ2VDb250ZXh0IHtcbiAgICBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnRcbiAgICB1c2VySWQ6IHN0cmluZ1xuICAgIHBsYW5UaWVyOiBQbGFuVGllclxuICAgIHBlcmlvZFN0YXJ0OiBzdHJpbmdcbiAgICByb3c6IFVzYWdlQ291bnRlcnNSb3dcbn1cblxuaW50ZXJmYWNlIFJlc29sdmVVc2FnZUNvbnRleHRPcHRpb25zIHtcbiAgICByZXF1aXJlQXV0aD86IGJvb2xlYW5cbn1cblxuaW50ZXJmYWNlIFJlc29sdmVkVXNhZ2VDb250ZXh0IHtcbiAgICBjb250ZXh0OiBVc2FnZUNvbnRleHQgfCBudWxsXG4gICAgc3RhdHVzPzogbnVtYmVyXG4gICAgZXJyb3I/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBRdW90YUNoZWNrUmVzdWx0IHtcbiAgICBvazogYm9vbGVhblxuICAgIHN0YXR1cz86IG51bWJlclxuICAgIGVycm9yPzogc3RyaW5nXG4gICAgY29udGV4dDogVXNhZ2VDb250ZXh0IHwgbnVsbFxuICAgIHVzZWQ/OiBudW1iZXJcbiAgICBsaW1pdD86IG51bWJlclxuICAgIHJlbWFpbmluZz86IG51bWJlclxuICAgIHBsYW5UaWVyPzogUGxhblRpZXJcbn1cblxuaW50ZXJmYWNlIEVuZm9yY2VVc2FnZVF1b3RhT3B0aW9ucyB7XG4gICAgcmVxdWlyZUF1dGg/OiBib29sZWFuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNhZ2VSZWNvcmRJbnB1dCB7XG4gICAgcHJvbXB0VG9rZW5zPzogbnVtYmVyXG4gICAgY29tcGxldGlvblRva2Vucz86IG51bWJlclxuICAgIHJlc2VuZENvc3RVc2Q/OiBudW1iZXJcbn1cblxuY29uc3QgUExBTl9MSU1JVFM6IFJlY29yZDxQbGFuVGllciwgUmVjb3JkPFVzYWdlTWV0cmljLCBudW1iZXI+PiA9IHtcbiAgICBmcmVlOiB7XG4gICAgICAgIGdlbmVyYXRlOiA1MCxcbiAgICAgICAgdHJhbnNjcmliZTogODAsXG4gICAgICAgIHNlbmRfZW1haWw6IDQwLFxuICAgIH0sXG4gICAgcHJvOiB7XG4gICAgICAgIGdlbmVyYXRlOiAyMDAwLFxuICAgICAgICB0cmFuc2NyaWJlOiA0MDAwLFxuICAgICAgICBzZW5kX2VtYWlsOiAxNTAwLFxuICAgIH0sXG59XG5cbmNvbnN0IE9QRU5BSV9JTlBVVF9DT1NUX1BFUl9UT0tFTiA9IDUgLyAxXzAwMF8wMDBcbmNvbnN0IE9QRU5BSV9PVVRQVVRfQ09TVF9QRVJfVE9LRU4gPSAxNSAvIDFfMDAwXzAwMFxuY29uc3QgREVGQVVMVF9SRVNFTkRfQ09TVF9VU0QgPSAwLjAwMVxuXG5mdW5jdGlvbiB0b1BsYW5UaWVyKHZhbHVlOiB1bmtub3duKTogUGxhblRpZXIge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gXCJwcm9cIiA/IFwicHJvXCIgOiBcImZyZWVcIlxufVxuXG5mdW5jdGlvbiB0b051bWJlcih2YWx1ZTogdW5rbm93bik6IG51bWJlciB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSByZXR1cm4gdmFsdWVcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IE51bWJlcih2YWx1ZSlcbiAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShwYXJzZWQpKSByZXR1cm4gcGFyc2VkXG4gICAgfVxuICAgIHJldHVybiAwXG59XG5cbmZ1bmN0aW9uIGdldE1vbnRoUGVyaW9kU3RhcnQoZGF0ZSA9IG5ldyBEYXRlKCkpOiBzdHJpbmcge1xuICAgIGNvbnN0IHV0YyA9IG5ldyBEYXRlKERhdGUuVVRDKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwgZGF0ZS5nZXRVVENNb250aCgpLCAxKSlcbiAgICByZXR1cm4gdXRjLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApXG59XG5cbmZ1bmN0aW9uIG1ldHJpY0NvdW50KHJvdzogVXNhZ2VDb3VudGVyc1JvdywgbWV0cmljOiBVc2FnZU1ldHJpYyk6IG51bWJlciB7XG4gICAgaWYgKG1ldHJpYyA9PT0gXCJnZW5lcmF0ZVwiKSByZXR1cm4gdG9OdW1iZXIocm93LmdlbmVyYXRlX2NvdW50KVxuICAgIGlmIChtZXRyaWMgPT09IFwidHJhbnNjcmliZVwiKSByZXR1cm4gdG9OdW1iZXIocm93LnRyYW5zY3JpYmVfY291bnQpXG4gICAgcmV0dXJuIHRvTnVtYmVyKHJvdy5zZW5kX2VtYWlsX2NvdW50KVxufVxuXG5hc3luYyBmdW5jdGlvbiBlbnN1cmVQcm9maWxlUm93KHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCwgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKFwicHJvZmlsZXNcIikudXBzZXJ0KFxuICAgICAgICAgICAgeyBpZDogdXNlcklkIH0sXG4gICAgICAgICAgICB7IG9uQ29uZmxpY3Q6IFwiaWRcIiwgaWdub3JlRHVwbGljYXRlczogdHJ1ZSB9XG4gICAgICAgIClcbiAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gUHJvZmlsZSBjcmVhdGlvbiBzaG91bGQgbm90IGJsb2NrIHJ1bnRpbWUgdXNhZ2UgY2hlY2tzLlxuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gbG9hZFBsYW5UaWVyKHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCwgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFBsYW5UaWVyPiB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJwcm9maWxlc1wiKVxuICAgICAgICAuc2VsZWN0KFwicGxhbl90aWVyXCIpXG4gICAgICAgIC5lcShcImlkXCIsIHVzZXJJZClcbiAgICAgICAgLm1heWJlU2luZ2xlKClcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gXCJmcmVlXCJcbiAgICB9XG5cbiAgICByZXR1cm4gdG9QbGFuVGllcihkYXRhPy5wbGFuX3RpZXIpXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlVXNhZ2VSb3coXG4gICAgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50LFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHBlcmlvZFN0YXJ0OiBzdHJpbmcsXG4gICAgcGxhblRpZXI6IFBsYW5UaWVyXG4pOiBQcm9taXNlPFVzYWdlQ291bnRlcnNSb3c+IHtcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nLCBlcnJvcjogZXhpc3RpbmdFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJ1c2FnZV9jb3VudGVyc19tb250aGx5XCIpXG4gICAgICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgICAgIC5lcShcInVzZXJfaWRcIiwgdXNlcklkKVxuICAgICAgICAuZXEoXCJwZXJpb2Rfc3RhcnRcIiwgcGVyaW9kU3RhcnQpXG4gICAgICAgIC5tYXliZVNpbmdsZSgpXG5cbiAgICBpZiAoZXhpc3RpbmdFcnJvcikgdGhyb3cgZXhpc3RpbmdFcnJvclxuICAgIGlmIChleGlzdGluZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uKGV4aXN0aW5nIGFzIFVzYWdlQ291bnRlcnNSb3cpLFxuICAgICAgICAgICAgcGxhbl90aWVyOiB0b1BsYW5UaWVyKGV4aXN0aW5nLnBsYW5fdGllciksXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwidXNhZ2VfY291bnRlcnNfbW9udGhseVwiKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIHBlcmlvZF9zdGFydDogcGVyaW9kU3RhcnQsXG4gICAgICAgICAgICBwbGFuX3RpZXI6IHBsYW5UaWVyLFxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgICAuc2luZ2xlKClcblxuICAgIGlmIChpbnNlcnRFcnJvciB8fCAhaW5zZXJ0ZWQpIHRocm93IGluc2VydEVycm9yIHx8IG5ldyBFcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIHVzYWdlIHJvd1wiKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4uKGluc2VydGVkIGFzIFVzYWdlQ291bnRlcnNSb3cpLFxuICAgICAgICBwbGFuX3RpZXI6IHRvUGxhblRpZXIoaW5zZXJ0ZWQucGxhbl90aWVyKSxcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVtaXRRdW90YU1pbGVzdG9uZUV2ZW50KFxuICAgIGNvbnRleHQ6IFVzYWdlQ29udGV4dCxcbiAgICBtZXRyaWM6IFVzYWdlTWV0cmljLFxuICAgIG1pbGVzdG9uZTogUXVvdGFNaWxlc3RvbmUsXG4gICAgdXNlZDogbnVtYmVyLFxuICAgIGxpbWl0OiBudW1iZXJcbik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGV2ZW50TmFtZSA9IG1pbGVzdG9uZSA9PT0gXCJ3YXJuaW5nXCIgPyBcImZyZWVfcXVvdGFfd2FybmluZ1wiIDogXCJmcmVlX3F1b3RhX2xpbWl0X2hpdFwiXG4gICAgY29uc3QgZXh0ZXJuYWxJZCA9IGBxdW90YToke2NvbnRleHQudXNlcklkfToke2NvbnRleHQucGVyaW9kU3RhcnR9OiR7bWV0cmljfToke21pbGVzdG9uZX1gXG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBjb250ZXh0LnN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbShcImFuYWx5dGljc19ldmVudHNcIilcbiAgICAgICAgICAgIC51cHNlcnQoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRfbmFtZTogZXZlbnROYW1lLFxuICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBcInBheXdhbGxcIixcbiAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWxfaWQ6IGV4dGVybmFsSWQsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWMsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJpb2RTdGFydDogY29udGV4dC5wZXJpb2RTdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYW5UaWVyOiBjb250ZXh0LnBsYW5UaWVyLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvbkNvbmZsaWN0OiBcImV4dGVybmFsX2lkXCIsXG4gICAgICAgICAgICAgICAgICAgIGlnbm9yZUR1cGxpY2F0ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyBBbmFseXRpY3MgaW5zZXJ0IHNob3VsZCBuZXZlciBicmVhayBjb3JlIGZsb3dzLlxuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVVzYWdlQ29udGV4dChcbiAgICByZXE6IFJlcXVlc3QsXG4gICAgb3B0aW9uczogUmVzb2x2ZVVzYWdlQ29udGV4dE9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTxSZXNvbHZlZFVzYWdlQ29udGV4dD4ge1xuICAgIGNvbnN0IHRva2VuID0gcGFyc2VCZWFyZXJUb2tlbihyZXEpXG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnJlcXVpcmVBdXRoKSB7XG4gICAgICAgICAgICByZXR1cm4geyBjb250ZXh0OiBudWxsLCBzdGF0dXM6IDQwMSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGNvbnRleHQ6IG51bGwgfVxuICAgIH1cblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQXV0aGVkU3VwYWJhc2VDbGllbnQodG9rZW4pXG4gICAgaWYgKCFzdXBhYmFzZSkge1xuICAgICAgICBpZiAob3B0aW9ucy5yZXF1aXJlQXV0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgY29udGV4dDogbnVsbCwgc3RhdHVzOiA1MDAsIGVycm9yOiBcIlN1cGFiYXNlIGlzIG5vdCBjb25maWd1cmVkXCIgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGNvbnRleHQ6IG51bGwgfVxuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgICAgZGF0YTogeyB1c2VyIH0sXG4gICAgICAgIGVycm9yOiB1c2VyRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG5cbiAgICBpZiAodXNlckVycm9yIHx8ICF1c2VyKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnJlcXVpcmVBdXRoKSB7XG4gICAgICAgICAgICByZXR1cm4geyBjb250ZXh0OiBudWxsLCBzdGF0dXM6IDQwMSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGNvbnRleHQ6IG51bGwgfVxuICAgIH1cblxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuaWRcbiAgICBjb25zdCBwZXJpb2RTdGFydCA9IGdldE1vbnRoUGVyaW9kU3RhcnQoKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZW5zdXJlUHJvZmlsZVJvdyhzdXBhYmFzZSwgdXNlcklkKVxuXG4gICAgICAgIGNvbnN0IHBsYW5UaWVyID0gYXdhaXQgbG9hZFBsYW5UaWVyKHN1cGFiYXNlLCB1c2VySWQpXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IGdldE9yQ3JlYXRlVXNhZ2VSb3coc3VwYWJhc2UsIHVzZXJJZCwgcGVyaW9kU3RhcnQsIHBsYW5UaWVyKVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgc3VwYWJhc2UsXG4gICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgIHBsYW5UaWVyLFxuICAgICAgICAgICAgICAgIHBlcmlvZFN0YXJ0LFxuICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXNhZ2UgY29udGV4dCByZXNvbHV0aW9uIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgICAgIGlmIChvcHRpb25zLnJlcXVpcmVBdXRoKSB7XG4gICAgICAgICAgICByZXR1cm4geyBjb250ZXh0OiBudWxsLCBzdGF0dXM6IDUwMCwgZXJyb3I6IFwiRmFpbGVkIHRvIHJlc29sdmUgdXNhZ2UgY29udGV4dFwiIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBjb250ZXh0OiBudWxsIH1cbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVXNhZ2VRdW90YShcbiAgICByZXE6IFJlcXVlc3QsXG4gICAgbWV0cmljOiBVc2FnZU1ldHJpYyxcbiAgICBvcHRpb25zOiBFbmZvcmNlVXNhZ2VRdW90YU9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTxRdW90YUNoZWNrUmVzdWx0PiB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCByZXNvbHZlVXNhZ2VDb250ZXh0KHJlcSwgeyByZXF1aXJlQXV0aDogQm9vbGVhbihvcHRpb25zLnJlcXVpcmVBdXRoKSB9KVxuICAgIGlmICghcmVzb2x2ZWQuY29udGV4dCkge1xuICAgICAgICBpZiAocmVzb2x2ZWQuZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN0YXR1czogcmVzb2x2ZWQuc3RhdHVzIHx8IDQwMSxcbiAgICAgICAgICAgICAgICBlcnJvcjogcmVzb2x2ZWQuZXJyb3IsXG4gICAgICAgICAgICAgICAgY29udGV4dDogbnVsbCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIGF1dGggdG9rZW4gYW5kIGF1dGggbm90IHJlcXVpcmVkOiBrZWVwIGVuZHBvaW50IHVzYWJsZSwgYnV0IG5vIHBlci11c2VyIHF1b3RhIGVuZm9yY2VtZW50LlxuICAgICAgICByZXR1cm4geyBvazogdHJ1ZSwgY29udGV4dDogbnVsbCB9XG4gICAgfVxuXG4gICAgY29uc3QgY29udGV4dCA9IHJlc29sdmVkLmNvbnRleHRcbiAgICBjb25zdCB1c2VkID0gbWV0cmljQ291bnQoY29udGV4dC5yb3csIG1ldHJpYylcbiAgICBjb25zdCBsaW1pdCA9IFBMQU5fTElNSVRTW2NvbnRleHQucGxhblRpZXJdW21ldHJpY11cbiAgICBjb25zdCByZW1haW5pbmcgPSBNYXRoLm1heCgwLCBsaW1pdCAtIHVzZWQpXG5cbiAgICBpZiAoY29udGV4dC5wbGFuVGllciA9PT0gXCJmcmVlXCIpIHtcbiAgICAgICAgaWYgKGxpbWl0ID4gMCAmJiB1c2VkID49IGxpbWl0KSB7XG4gICAgICAgICAgICBhd2FpdCBlbWl0UXVvdGFNaWxlc3RvbmVFdmVudChjb250ZXh0LCBtZXRyaWMsIFwibGltaXRcIiwgdXNlZCwgbGltaXQpXG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN0YXR1czogNDAyLFxuICAgICAgICAgICAgICAgIGVycm9yOiBgRnJlZSBwbGFuIG1vbnRobHkgbGltaXQgcmVhY2hlZCBmb3IgJHttZXRyaWN9LmAsXG4gICAgICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgICAgICB1c2VkLFxuICAgICAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgICAgIHJlbWFpbmluZyxcbiAgICAgICAgICAgICAgICBwbGFuVGllcjogY29udGV4dC5wbGFuVGllcixcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsaW1pdCA+IDAgJiYgdXNlZCA+PSBNYXRoLmNlaWwobGltaXQgKiAwLjgpKSB7XG4gICAgICAgICAgICBhd2FpdCBlbWl0UXVvdGFNaWxlc3RvbmVFdmVudChjb250ZXh0LCBtZXRyaWMsIFwid2FybmluZ1wiLCB1c2VkLCBsaW1pdClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIG9rOiB0cnVlLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICB1c2VkLFxuICAgICAgICBsaW1pdCxcbiAgICAgICAgcmVtYWluaW5nLFxuICAgICAgICBwbGFuVGllcjogY29udGV4dC5wbGFuVGllcixcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvcmRVc2FnZShcbiAgICBjb250ZXh0OiBVc2FnZUNvbnRleHQgfCBudWxsLFxuICAgIG1ldHJpYzogVXNhZ2VNZXRyaWMsXG4gICAgaW5wdXQ6IFVzYWdlUmVjb3JkSW5wdXQgPSB7fVxuKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCFjb250ZXh0KSByZXR1cm5cblxuICAgIGNvbnN0IGN1cnJlbnQgPSBjb250ZXh0LnJvd1xuICAgIGNvbnN0IG5leHRHZW5lcmF0ZUNvdW50ID0gdG9OdW1iZXIoY3VycmVudC5nZW5lcmF0ZV9jb3VudCkgKyAobWV0cmljID09PSBcImdlbmVyYXRlXCIgPyAxIDogMClcbiAgICBjb25zdCBuZXh0VHJhbnNjcmliZUNvdW50ID0gdG9OdW1iZXIoY3VycmVudC50cmFuc2NyaWJlX2NvdW50KSArIChtZXRyaWMgPT09IFwidHJhbnNjcmliZVwiID8gMSA6IDApXG4gICAgY29uc3QgbmV4dFNlbmRFbWFpbENvdW50ID0gdG9OdW1iZXIoY3VycmVudC5zZW5kX2VtYWlsX2NvdW50KSArIChtZXRyaWMgPT09IFwic2VuZF9lbWFpbFwiID8gMSA6IDApXG5cbiAgICBjb25zdCBwcm9tcHRUb2tlbnMgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKGlucHV0LnByb21wdFRva2VucyB8fCAwKSlcbiAgICBjb25zdCBjb21wbGV0aW9uVG9rZW5zID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihpbnB1dC5jb21wbGV0aW9uVG9rZW5zIHx8IDApKVxuICAgIGNvbnN0IG9wZW5haUNvc3RJbmNyZW1lbnQgPVxuICAgICAgICBwcm9tcHRUb2tlbnMgKiBPUEVOQUlfSU5QVVRfQ09TVF9QRVJfVE9LRU4gKyBjb21wbGV0aW9uVG9rZW5zICogT1BFTkFJX09VVFBVVF9DT1NUX1BFUl9UT0tFTlxuXG4gICAgY29uc3QgcmVzZW5kQ29zdEluY3JlbWVudCA9IG1ldHJpYyA9PT0gXCJzZW5kX2VtYWlsXCJcbiAgICAgICAgPyBNYXRoLm1heCgwLCBOdW1iZXIuaXNGaW5pdGUoaW5wdXQucmVzZW5kQ29zdFVzZCkgPyBOdW1iZXIoaW5wdXQucmVzZW5kQ29zdFVzZCkgOiBERUZBVUxUX1JFU0VORF9DT1NUX1VTRClcbiAgICAgICAgOiAwXG5cbiAgICBjb25zdCBuZXh0Um93VXBkYXRlID0ge1xuICAgICAgICBwbGFuX3RpZXI6IGNvbnRleHQucGxhblRpZXIsXG4gICAgICAgIGdlbmVyYXRlX2NvdW50OiBuZXh0R2VuZXJhdGVDb3VudCxcbiAgICAgICAgdHJhbnNjcmliZV9jb3VudDogbmV4dFRyYW5zY3JpYmVDb3VudCxcbiAgICAgICAgc2VuZF9lbWFpbF9jb3VudDogbmV4dFNlbmRFbWFpbENvdW50LFxuICAgICAgICBvcGVuYWlfcHJvbXB0X3Rva2VuczogdG9OdW1iZXIoY3VycmVudC5vcGVuYWlfcHJvbXB0X3Rva2VucykgKyBwcm9tcHRUb2tlbnMsXG4gICAgICAgIG9wZW5haV9jb21wbGV0aW9uX3Rva2VuczogdG9OdW1iZXIoY3VycmVudC5vcGVuYWlfY29tcGxldGlvbl90b2tlbnMpICsgY29tcGxldGlvblRva2VucyxcbiAgICAgICAgb3BlbmFpX2VzdGltYXRlZF9jb3N0OiBOdW1iZXIoKHRvTnVtYmVyKGN1cnJlbnQub3BlbmFpX2VzdGltYXRlZF9jb3N0KSArIG9wZW5haUNvc3RJbmNyZW1lbnQpLnRvRml4ZWQoNikpLFxuICAgICAgICByZXNlbmRfZXN0aW1hdGVkX2Nvc3Q6IE51bWJlcigodG9OdW1iZXIoY3VycmVudC5yZXNlbmRfZXN0aW1hdGVkX2Nvc3QpICsgcmVzZW5kQ29zdEluY3JlbWVudCkudG9GaXhlZCg2KSksXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgY29udGV4dC5zdXBhYmFzZVxuICAgICAgICAuZnJvbShcInVzYWdlX2NvdW50ZXJzX21vbnRobHlcIilcbiAgICAgICAgLnVwZGF0ZShuZXh0Um93VXBkYXRlKVxuICAgICAgICAuZXEoXCJpZFwiLCBjdXJyZW50LmlkKVxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1cGRhdGVFcnJvciB8fCAhdXBkYXRlZCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSB1c2FnZSBjb3VudGVyczpcIiwgdXBkYXRlRXJyb3IpXG4gICAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IG5vcm1hbGl6ZWRVcGRhdGVkOiBVc2FnZUNvdW50ZXJzUm93ID0ge1xuICAgICAgICAuLi4odXBkYXRlZCBhcyBVc2FnZUNvdW50ZXJzUm93KSxcbiAgICAgICAgcGxhbl90aWVyOiB0b1BsYW5UaWVyKHVwZGF0ZWQucGxhbl90aWVyKSxcbiAgICB9XG5cbiAgICBjb250ZXh0LnJvdyA9IG5vcm1hbGl6ZWRVcGRhdGVkXG5cbiAgICBpZiAoY29udGV4dC5wbGFuVGllciAhPT0gXCJmcmVlXCIpIHJldHVyblxuXG4gICAgY29uc3QgdXBkYXRlZFVzZWQgPSBtZXRyaWNDb3VudChub3JtYWxpemVkVXBkYXRlZCwgbWV0cmljKVxuICAgIGNvbnN0IGxpbWl0ID0gUExBTl9MSU1JVFNbY29udGV4dC5wbGFuVGllcl1bbWV0cmljXVxuXG4gICAgaWYgKGxpbWl0ID4gMCAmJiB1cGRhdGVkVXNlZCA+PSBsaW1pdCkge1xuICAgICAgICBhd2FpdCBlbWl0UXVvdGFNaWxlc3RvbmVFdmVudChjb250ZXh0LCBtZXRyaWMsIFwibGltaXRcIiwgdXBkYXRlZFVzZWQsIGxpbWl0KVxuICAgICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBpZiAobGltaXQgPiAwICYmIHVwZGF0ZWRVc2VkID49IE1hdGguY2VpbChsaW1pdCAqIDAuOCkpIHtcbiAgICAgICAgYXdhaXQgZW1pdFF1b3RhTWlsZXN0b25lRXZlbnQoY29udGV4dCwgbWV0cmljLCBcIndhcm5pbmdcIiwgdXBkYXRlZFVzZWQsIGxpbWl0KVxuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzYWdlU25hcHNob3QocmVxOiBSZXF1ZXN0KTogUHJvbWlzZTxcbiAgICB8IHtcbiAgICAgICAgb2s6IHRydWVcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcGxhblRpZXI6IFBsYW5UaWVyXG4gICAgICAgICAgICBwZXJpb2RTdGFydDogc3RyaW5nXG4gICAgICAgICAgICB1c2FnZTogUmVjb3JkPFVzYWdlTWV0cmljLCBudW1iZXI+XG4gICAgICAgICAgICBsaW1pdHM6IFJlY29yZDxVc2FnZU1ldHJpYywgbnVtYmVyPlxuICAgICAgICAgICAgcmVtYWluaW5nOiBSZWNvcmQ8VXNhZ2VNZXRyaWMsIG51bWJlcj5cbiAgICAgICAgICAgIHVzYWdlUmF0ZVBjdDogUmVjb3JkPFVzYWdlTWV0cmljLCBudW1iZXI+XG4gICAgICAgICAgICBvcGVuYWlQcm9tcHRUb2tlbnM6IG51bWJlclxuICAgICAgICAgICAgb3BlbmFpQ29tcGxldGlvblRva2VuczogbnVtYmVyXG4gICAgICAgICAgICBlc3RpbWF0ZWRDb3N0czoge1xuICAgICAgICAgICAgICAgIG9wZW5haTogbnVtYmVyXG4gICAgICAgICAgICAgICAgcmVzZW5kOiBudW1iZXJcbiAgICAgICAgICAgICAgICB0b3RhbDogbnVtYmVyXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB8IHsgb2s6IGZhbHNlOyBzdGF0dXM6IG51bWJlcjsgZXJyb3I6IHN0cmluZyB9XG4+IHtcbiAgICBjb25zdCByZXNvbHZlZCA9IGF3YWl0IHJlc29sdmVVc2FnZUNvbnRleHQocmVxLCB7IHJlcXVpcmVBdXRoOiB0cnVlIH0pXG5cbiAgICBpZiAoIXJlc29sdmVkLmNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICAgIHN0YXR1czogcmVzb2x2ZWQuc3RhdHVzIHx8IDQwMSxcbiAgICAgICAgICAgIGVycm9yOiByZXNvbHZlZC5lcnJvciB8fCBcIlVuYXV0aG9yaXplZFwiLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgeyBwbGFuVGllciwgcGVyaW9kU3RhcnQsIHJvdyB9ID0gcmVzb2x2ZWQuY29udGV4dFxuICAgIGNvbnN0IHVzYWdlID0ge1xuICAgICAgICBnZW5lcmF0ZTogdG9OdW1iZXIocm93LmdlbmVyYXRlX2NvdW50KSxcbiAgICAgICAgdHJhbnNjcmliZTogdG9OdW1iZXIocm93LnRyYW5zY3JpYmVfY291bnQpLFxuICAgICAgICBzZW5kX2VtYWlsOiB0b051bWJlcihyb3cuc2VuZF9lbWFpbF9jb3VudCksXG4gICAgfVxuICAgIGNvbnN0IGxpbWl0cyA9IFBMQU5fTElNSVRTW3BsYW5UaWVyXVxuICAgIGNvbnN0IHJlbWFpbmluZyA9IHtcbiAgICAgICAgZ2VuZXJhdGU6IE1hdGgubWF4KDAsIGxpbWl0cy5nZW5lcmF0ZSAtIHVzYWdlLmdlbmVyYXRlKSxcbiAgICAgICAgdHJhbnNjcmliZTogTWF0aC5tYXgoMCwgbGltaXRzLnRyYW5zY3JpYmUgLSB1c2FnZS50cmFuc2NyaWJlKSxcbiAgICAgICAgc2VuZF9lbWFpbDogTWF0aC5tYXgoMCwgbGltaXRzLnNlbmRfZW1haWwgLSB1c2FnZS5zZW5kX2VtYWlsKSxcbiAgICB9XG4gICAgY29uc3QgdXNhZ2VSYXRlUGN0ID0ge1xuICAgICAgICBnZW5lcmF0ZTogbGltaXRzLmdlbmVyYXRlID4gMCA/IE51bWJlcigoKHVzYWdlLmdlbmVyYXRlIC8gbGltaXRzLmdlbmVyYXRlKSAqIDEwMCkudG9GaXhlZCgxKSkgOiAwLFxuICAgICAgICB0cmFuc2NyaWJlOiBsaW1pdHMudHJhbnNjcmliZSA+IDAgPyBOdW1iZXIoKCh1c2FnZS50cmFuc2NyaWJlIC8gbGltaXRzLnRyYW5zY3JpYmUpICogMTAwKS50b0ZpeGVkKDEpKSA6IDAsXG4gICAgICAgIHNlbmRfZW1haWw6IGxpbWl0cy5zZW5kX2VtYWlsID4gMCA/IE51bWJlcigoKHVzYWdlLnNlbmRfZW1haWwgLyBsaW1pdHMuc2VuZF9lbWFpbCkgKiAxMDApLnRvRml4ZWQoMSkpIDogMCxcbiAgICB9XG5cbiAgICBjb25zdCBlc3RpbWF0ZWRPcGVuYWkgPSBOdW1iZXIodG9OdW1iZXIocm93Lm9wZW5haV9lc3RpbWF0ZWRfY29zdCkudG9GaXhlZCg0KSlcbiAgICBjb25zdCBlc3RpbWF0ZWRSZXNlbmQgPSBOdW1iZXIodG9OdW1iZXIocm93LnJlc2VuZF9lc3RpbWF0ZWRfY29zdCkudG9GaXhlZCg0KSlcblxuICAgIHJldHVybiB7XG4gICAgICAgIG9rOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwbGFuVGllcixcbiAgICAgICAgICAgIHBlcmlvZFN0YXJ0LFxuICAgICAgICAgICAgdXNhZ2UsXG4gICAgICAgICAgICBsaW1pdHMsXG4gICAgICAgICAgICByZW1haW5pbmcsXG4gICAgICAgICAgICB1c2FnZVJhdGVQY3QsXG4gICAgICAgICAgICBvcGVuYWlQcm9tcHRUb2tlbnM6IHRvTnVtYmVyKHJvdy5vcGVuYWlfcHJvbXB0X3Rva2VucyksXG4gICAgICAgICAgICBvcGVuYWlDb21wbGV0aW9uVG9rZW5zOiB0b051bWJlcihyb3cub3BlbmFpX2NvbXBsZXRpb25fdG9rZW5zKSxcbiAgICAgICAgICAgIGVzdGltYXRlZENvc3RzOiB7XG4gICAgICAgICAgICAgICAgb3BlbmFpOiBlc3RpbWF0ZWRPcGVuYWksXG4gICAgICAgICAgICAgICAgcmVzZW5kOiBlc3RpbWF0ZWRSZXNlbmQsXG4gICAgICAgICAgICAgICAgdG90YWw6IE51bWJlcigoZXN0aW1hdGVkT3BlbmFpICsgZXN0aW1hdGVkUmVzZW5kKS50b0ZpeGVkKDQpKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUF1dGhlZFN1cGFiYXNlQ2xpZW50IiwicGFyc2VCZWFyZXJUb2tlbiIsIlBMQU5fTElNSVRTIiwiZnJlZSIsImdlbmVyYXRlIiwidHJhbnNjcmliZSIsInNlbmRfZW1haWwiLCJwcm8iLCJPUEVOQUlfSU5QVVRfQ09TVF9QRVJfVE9LRU4iLCJPUEVOQUlfT1VUUFVUX0NPU1RfUEVSX1RPS0VOIiwiREVGQVVMVF9SRVNFTkRfQ09TVF9VU0QiLCJ0b1BsYW5UaWVyIiwidmFsdWUiLCJ0b051bWJlciIsIk51bWJlciIsImlzRmluaXRlIiwicGFyc2VkIiwiZ2V0TW9udGhQZXJpb2RTdGFydCIsImRhdGUiLCJEYXRlIiwidXRjIiwiVVRDIiwiZ2V0VVRDRnVsbFllYXIiLCJnZXRVVENNb250aCIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJtZXRyaWNDb3VudCIsInJvdyIsIm1ldHJpYyIsImdlbmVyYXRlX2NvdW50IiwidHJhbnNjcmliZV9jb3VudCIsInNlbmRfZW1haWxfY291bnQiLCJlbnN1cmVQcm9maWxlUm93Iiwic3VwYWJhc2UiLCJ1c2VySWQiLCJmcm9tIiwidXBzZXJ0IiwiaWQiLCJvbkNvbmZsaWN0IiwiaWdub3JlRHVwbGljYXRlcyIsImxvYWRQbGFuVGllciIsImRhdGEiLCJlcnJvciIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJwbGFuX3RpZXIiLCJnZXRPckNyZWF0ZVVzYWdlUm93IiwicGVyaW9kU3RhcnQiLCJwbGFuVGllciIsImV4aXN0aW5nIiwiZXhpc3RpbmdFcnJvciIsImluc2VydGVkIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJ1c2VyX2lkIiwicGVyaW9kX3N0YXJ0Iiwic2luZ2xlIiwiRXJyb3IiLCJlbWl0UXVvdGFNaWxlc3RvbmVFdmVudCIsImNvbnRleHQiLCJtaWxlc3RvbmUiLCJ1c2VkIiwibGltaXQiLCJldmVudE5hbWUiLCJleHRlcm5hbElkIiwiZXZlbnRfbmFtZSIsImNoYW5uZWwiLCJleHRlcm5hbF9pZCIsIm1ldGFkYXRhIiwicmVzb2x2ZVVzYWdlQ29udGV4dCIsInJlcSIsIm9wdGlvbnMiLCJ0b2tlbiIsInJlcXVpcmVBdXRoIiwic3RhdHVzIiwidXNlciIsInVzZXJFcnJvciIsImF1dGgiLCJnZXRVc2VyIiwiY29uc29sZSIsImVuZm9yY2VVc2FnZVF1b3RhIiwicmVzb2x2ZWQiLCJCb29sZWFuIiwib2siLCJyZW1haW5pbmciLCJNYXRoIiwibWF4IiwiY2VpbCIsInJlY29yZFVzYWdlIiwiaW5wdXQiLCJjdXJyZW50IiwibmV4dEdlbmVyYXRlQ291bnQiLCJuZXh0VHJhbnNjcmliZUNvdW50IiwibmV4dFNlbmRFbWFpbENvdW50IiwicHJvbXB0VG9rZW5zIiwiZmxvb3IiLCJjb21wbGV0aW9uVG9rZW5zIiwib3BlbmFpQ29zdEluY3JlbWVudCIsInJlc2VuZENvc3RJbmNyZW1lbnQiLCJyZXNlbmRDb3N0VXNkIiwibmV4dFJvd1VwZGF0ZSIsIm9wZW5haV9wcm9tcHRfdG9rZW5zIiwib3BlbmFpX2NvbXBsZXRpb25fdG9rZW5zIiwib3BlbmFpX2VzdGltYXRlZF9jb3N0IiwidG9GaXhlZCIsInJlc2VuZF9lc3RpbWF0ZWRfY29zdCIsInVwZGF0ZWRfYXQiLCJ1cGRhdGVkIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJub3JtYWxpemVkVXBkYXRlZCIsInVwZGF0ZWRVc2VkIiwiZ2V0VXNhZ2VTbmFwc2hvdCIsInVzYWdlIiwibGltaXRzIiwidXNhZ2VSYXRlUGN0IiwiZXN0aW1hdGVkT3BlbmFpIiwiZXN0aW1hdGVkUmVzZW5kIiwib3BlbmFpUHJvbXB0VG9rZW5zIiwib3BlbmFpQ29tcGxldGlvblRva2VucyIsImVzdGltYXRlZENvc3RzIiwib3BlbmFpIiwicmVzZW5kIiwidG90YWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/usage-quota.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/openai"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkim-young-gwang%2FDesktop%2FSnapQuote%20(Trade-Focused%20AI%20Estimator)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();